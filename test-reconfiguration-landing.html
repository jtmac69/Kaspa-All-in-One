<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Reconfiguration Landing Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
    </style>
</head>
<body>
    <h1>Reconfiguration Landing Page Test</h1>
    
    <div class="test-section">
        <h2>API Tests</h2>
        <button class="btn-primary" onclick="testProfilesState()">Test Profiles State API</button>
        <button class="btn-primary" onclick="testWizardMode()">Test Wizard Mode API</button>
        <div id="api-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Frontend Integration Test</h2>
        <button class="btn-primary" onclick="testReconfigurationLanding()">Test Reconfiguration Landing</button>
        <button class="btn-secondary" onclick="openWizardInReconfigMode()">Open Wizard in Reconfig Mode</button>
        <div id="frontend-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Mock Data Test</h2>
        <button class="btn-primary" onclick="createMockInstallation()">Create Mock Installation</button>
        <button class="btn-secondary" onclick="clearMockData()">Clear Mock Data</button>
        <div id="mock-results"></div>
    </div>

    <script>
        async function testProfilesState() {
            const resultsDiv = document.getElementById('api-results');
            try {
                const response = await fetch('/api/wizard/profiles/state');
                const data = await response.json();
                
                if (data.success) {
                    resultsDiv.innerHTML += `
                        <div class="test-result success">
                            ✓ Profiles State API working<br>
                            - Found ${data.profileStates.length} profiles<br>
                            - ${data.installedProfiles.length} installed<br>
                            - ${data.availableProfiles.length} available<br>
                            - ${data.suggestions.length} suggestions
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML += `
                        <div class="test-result error">
                            ✗ Profiles State API failed: ${data.error}
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="test-result error">
                        ✗ Profiles State API error: ${error.message}
                    </div>
                `;
            }
        }
        
        async function testWizardMode() {
            const resultsDiv = document.getElementById('api-results');
            try {
                const response = await fetch('/api/wizard/mode?mode=reconfigure');
                const data = await response.json();
                
                resultsDiv.innerHTML += `
                    <div class="test-result ${data.mode === 'reconfigure' ? 'success' : 'error'}">
                        ${data.mode === 'reconfigure' ? '✓' : '✗'} Wizard Mode API<br>
                        - Mode: ${data.mode}<br>
                        - Reason: ${data.reason}<br>
                        - Can Reconfigure: ${data.canReconfigure}
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="test-result error">
                        ✗ Wizard Mode API error: ${error.message}
                    </div>
                `;
            }
        }
        
        function testReconfigurationLanding() {
            const resultsDiv = document.getElementById('frontend-results');
            
            // Check if reconfiguration landing HTML exists
            const hasReconfigStep = document.querySelector('#step-reconfigure-landing') !== null;
            
            resultsDiv.innerHTML += `
                <div class="test-result ${hasReconfigStep ? 'success' : 'error'}">
                    ${hasReconfigStep ? '✓' : '✗'} Reconfiguration landing step HTML exists
                </div>
            `;
            
            // Test if we can access the wizard page
            const wizardUrl = window.location.origin + '/?mode=reconfigure';
            resultsDiv.innerHTML += `
                <div class="test-result info">
                    ℹ Wizard URL: <a href="${wizardUrl}" target="_blank">${wizardUrl}</a>
                </div>
            `;
        }
        
        function openWizardInReconfigMode() {
            const wizardUrl = window.location.origin + '/?mode=reconfigure';
            window.open(wizardUrl, '_blank');
        }
        
        async function createMockInstallation() {
            const resultsDiv = document.getElementById('mock-results');
            
            // Create mock .env file
            const mockEnv = `
# Mock installation for testing
KASPA_NODE_RPC_PORT=16110
KASPA_NODE_P2P_PORT=16111
KASPA_NETWORK=mainnet
DASHBOARD_PORT=3000
KASIA_APP_PORT=3001
PUBLIC_NODE=false
POSTGRES_PASSWORD=test123
            `.trim();
            
            // Create mock installation state
            const mockState = {
                version: '1.0.0',
                installedAt: new Date().toISOString(),
                lastModified: new Date().toISOString(),
                phase: 'complete',
                profiles: {
                    selected: ['core', 'kaspa-user-applications'],
                    configuration: {
                        KASPA_NODE_RPC_PORT: 16110,
                        KASPA_NODE_P2P_PORT: 16111,
                        KASPA_NETWORK: 'mainnet'
                    }
                }
            };
            
            try {
                // This would normally create files on the server
                // For testing, we'll just show what would be created
                resultsDiv.innerHTML += `
                    <div class="test-result info">
                        ℹ Mock installation data prepared:<br>
                        - .env file with ${mockEnv.split('\n').length} lines<br>
                        - Installation state with ${mockState.profiles.selected.length} profiles<br>
                        - Phase: ${mockState.phase}<br>
                        <br>
                        <strong>Note:</strong> This is a simulation. Real implementation would create actual files.
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="test-result error">
                        ✗ Mock installation error: ${error.message}
                    </div>
                `;
            }
        }
        
        function clearMockData() {
            const resultsDiv = document.getElementById('mock-results');
            resultsDiv.innerHTML += `
                <div class="test-result info">
                    ℹ Mock data cleared (simulation)
                </div>
            `;
        }
        
        // Auto-run basic tests on page load
        window.addEventListener('load', () => {
            testWizardMode();
            testProfilesState();
        });
    </script>
</body>
</html>