# Docker Compose for Kaspa All-in-One
# Generated by Installation Wizard
# Date: 2025-12-31T22:59:09.506Z

services:
  # ============================================================================
  # CORE INFRASTRUCTURE
  # ============================================================================
  
  # Kaspa Node - Official Docker image (Core component)
  kaspa-node:
    image: kaspanet/rusty-kaspad:latest
    container_name: kaspa-node
    restart: unless-stopped
    ports:
      - "${KASPA_NODE_P2P_PORT:-16111}:16111"  # P2P port (public)
      - "${KASPA_NODE_RPC_PORT:-16110}:16110"  # RPC port (local access)
    volumes:
      - kaspa-data:/data/kaspa
      - ./logs/kaspa-node:/app/logs
    environment:
      - PUBLIC_NODE=${PUBLIC_NODE:-true}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - KASPAD_UTXOINDEX=true
      - KASPAD_RPCBIND=0.0.0.0:16110
      - KASPAD_RPCLISTEN_BORSH=0.0.0.0:17110
      - KASPAD_RPCLISTEN_JSON=0.0.0.0:18110
    command: "kaspad --utxoindex --rpclisten=0.0.0.0:16110 --listen=0.0.0.0:16111"
    networks:
      - kaspa-network
    profiles:
      - core

  # Installation Wizard (DEPRECATED - Runs on host, not in container)
  # NOTE: The wizard should be started using ./services/wizard/backend/start-local.sh
  wizard:
    build:
      context: ./services/wizard
      dockerfile: Dockerfile
    container_name: kaspa-wizard
    restart: "no"
    ports:
      - "${WIZARD_PORT:-3000}:3000"
    environment:
      - NODE_ENV=${NODE_ENV:-production}
      - WIZARD_MODE=${WIZARD_MODE:-install}
      - DOCKER_HOST=unix:///var/run/docker.sock
      - PROJECT_ROOT=/workspace
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - .:/workspace
      - ./.env:/workspace/.env
      - ./docker-compose.yml:/workspace/docker-compose.yml:ro
      - wizard-state:/app/state
    networks:
      - kaspa-network
    profiles:
      - wizard

volumes:
  kaspa-data:
  wizard-state:

networks:
  kaspa-network:
    driver: bridge
