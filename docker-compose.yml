# Docker Compose for Kaspa All-in-One
# Generated by Installation Wizard
# Date: 2025-12-10T18:14:57.669Z

services:
  # ============================================================================
  # CORE INFRASTRUCTURE
  # ============================================================================
  
  # Installation Wizard (DEPRECATED - Runs on host, not in container)
  # NOTE: The wizard should be started using ./services/wizard/backend/start-local.sh
  wizard:
    build:
      context: ./services/wizard
      dockerfile: Dockerfile
    container_name: kaspa-wizard
    restart: "no"
    ports:
      - "${WIZARD_PORT:-3000}:3000"
    environment:
      - NODE_ENV=${NODE_ENV:-production}
      - WIZARD_MODE=${WIZARD_MODE:-install}
      - DOCKER_HOST=unix:///var/run/docker.sock
      - PROJECT_ROOT=/workspace
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - .:/workspace
      - ./.env:/workspace/.env
      - ./docker-compose.yml:/workspace/docker-compose.yml:ro
      - wizard-state:/app/state
    networks:
      - kaspa-network
    profiles:
      - wizard

  # ============================================================================
  # KASPA-USER-APPLICATIONS PROFILE - User-facing applications
  # ============================================================================

  # Kasia Messaging App
  kasia-app:
    build:
      context: ./services/kasia
      dockerfile: Dockerfile
      args:
        - KASIA_VERSION=v0.6.2
    container_name: kasia-app
    restart: unless-stopped
    ports:
      - "${KASIA_APP_PORT:-3001}:3000"
    environment:
      - VITE_DEFAULT_KASPA_NETWORK=${KASPA_NETWORK:-mainnet}
      - VITE_INDEXER_MAINNET_URL=${REMOTE_KASIA_INDEXER_URL:-https://indexer.kasia.fyi/}
      - VITE_DEFAULT_MAINNET_KASPA_NODE_URL=${REMOTE_KASPA_NODE_WBORSH_URL:-wss://wrpc.kasia.fyi}
    networks:
      - kaspa-network
    profiles:
      - kaspa-user-applications

  # K Social App
  k-social:
    build:
      context: ./services/k-social
      dockerfile: Dockerfile
    container_name: k-social
    restart: unless-stopped
    ports:
      - "${KSOCIAL_APP_PORT:-3003}:3000"
    environment:
      - KASPA_NODE_URL=${REMOTE_KASPA_NODE_URL:-http://kaspa-node:16110}
    networks:
      - kaspa-network
    profiles:
      - kaspa-user-applications

  # Kaspa Explorer
  kaspa-explorer:
    build:
      context: ./services/kaspa-explorer
      dockerfile: Dockerfile
    container_name: kaspa-explorer
    restart: unless-stopped
    ports:
      - "${KASPA_EXPLORER_PORT:-3004}:80"
    environment:
      - KASPA_NETWORK=${KASPA_NETWORK:-mainnet}
      - API_BASE_URL=${REMOTE_KASIA_INDEXER_URL:-https://indexer.kasia.fyi/}
    networks:
      - kaspa-network
    profiles:
      - kaspa-user-applications

volumes:
  kaspa-data:
  wizard-state:

networks:
  kaspa-network:
    driver: bridge
