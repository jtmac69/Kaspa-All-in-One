<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Enhanced Installation Progress Display</title>
    <link rel="stylesheet" href="/styles/wizard.css">
    <style>
        body {
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .test-controls h3 {
            margin-top: 0;
            margin-bottom: 15px;
        }
        .test-controls button {
            display: block;
            width: 100%;
            margin-bottom: 10px;
            padding: 10px;
            background: #70C7BA;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        .test-controls button:hover {
            background: #49C8B5;
        }
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .test-section h2 {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <h1>Enhanced Installation Progress Display Test</h1>
    <p>This page demonstrates the enhanced real-time progress display features for Task 1.5.2</p>

    <div class="test-controls">
        <h3>Test Scenarios</h3>
        <button onclick="simulateInit()">1. Init Stage (0-10%)</button>
        <button onclick="simulateConfig()">2. Config Stage (10-20%)</button>
        <button onclick="simulatePull()">3. Pull Stage (20-50%)</button>
        <button onclick="simulateBuild()">4. Build Stage (50-75%)</button>
        <button onclick="simulateDeploy()">5. Deploy Stage (75-95%)</button>
        <button onclick="simulateValidate()">6. Validate Stage (95-100%)</button>
        <button onclick="simulateComplete()">7. Complete (100%)</button>
        <button onclick="simulateFullInstall()">▶ Simulate Full Install</button>
        <button onclick="resetProgress()">↻ Reset</button>
    </div>

    <div class="test-section">
        <h2>Installation Progress</h2>
        <div class="install-progress">
            <!-- Progress Bar -->
            <div class="progress-bar-container">
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="install-progress-bar" style="width: 0%"></div>
                </div>
                <div class="progress-percentage" id="install-progress-percentage">0%</div>
            </div>

            <!-- Time Estimate -->
            <div id="install-time-estimate" style="display: none;">
                Estimated time remaining: 10 minutes
            </div>

            <!-- Installation Statistics -->
            <div id="install-stats-container" class="install-stats-container" style="display: none;">
                <!-- Stats will be populated dynamically -->
            </div>

            <!-- Status -->
            <div class="install-status">
                <div class="status-icon">
                    <div class="spinner"></div>
                </div>
                <div class="status-content">
                    <h3 class="status-title" id="install-status-title">Initializing...</h3>
                    <p class="status-message" id="install-status-message">Preparing installation environment</p>
                </div>
            </div>

            <!-- Service Progress (will be added dynamically) -->
            <div id="service-progress-container"></div>

            <!-- Install Steps -->
            <div class="install-steps">
                <div class="install-step pending" data-step="env">
                    <div class="install-step-icon">⏳</div>
                    <div class="install-step-content">
                        <h4 class="install-step-title">Creating environment configuration</h4>
                        <p class="install-step-status">Pending</p>
                    </div>
                </div>

                <div class="install-step pending" data-step="pull">
                    <div class="install-step-icon">⏳</div>
                    <div class="install-step-content">
                        <h4 class="install-step-title">Pulling Docker images</h4>
                        <p class="install-step-status">Pending</p>
                    </div>
                </div>

                <div class="install-step pending" data-step="start">
                    <div class="install-step-icon">⏳</div>
                    <div class="install-step-content">
                        <h4 class="install-step-title">Starting services</h4>
                        <p class="install-step-status">Pending</p>
                    </div>
                </div>

                <div class="install-step pending" data-step="health">
                    <div class="install-step-icon">⏳</div>
                    <div class="install-step-content">
                        <h4 class="install-step-title">Running health checks</h4>
                        <p class="install-step-status">Pending</p>
                    </div>
                </div>
            </div>

            <!-- Logs -->
            <div class="install-logs">
                <div class="logs-header">
                    <h4 class="logs-title">Installation Logs <span id="install-log-count" style="display: none;">0</span></h4>
                    <button class="btn-secondary btn-small" onclick="toggleLogs()">
                        <span id="logs-toggle-text">Show Details</span>
                    </button>
                </div>
                <div class="logs-content" id="install-logs-content" style="display: none;">
                    <pre class="logs-text" id="install-logs-text">Waiting for installation to start...</pre>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { 
            updateInstallationUI, 
            updateServiceProgress, 
            updateInstallationStats 
        } from '/scripts/modules/install.js';

        // Make functions globally available
        window.updateInstallationUI = updateInstallationUI;
        window.updateServiceProgress = updateServiceProgress;
        window.updateInstallationStats = updateInstallationStats;

        // Test scenario functions
        window.simulateInit = function() {
            updateInstallationUI({
                stage: 'init',
                message: 'Initializing installation environment',
                progress: 5,
                details: {}
            });
            updateInstallationStats({
                servicesTotal: 5,
                servicesComplete: 0,
                elapsedTime: 10
            });
        };

        window.simulateConfig = function() {
            updateInstallationUI({
                stage: 'config',
                message: 'Creating .env configuration file',
                progress: 15,
                details: {}
            });
            updateInstallationStats({
                servicesTotal: 5,
                servicesComplete: 0,
                elapsedTime: 30
            });
        };

        window.simulatePull = function() {
            updateInstallationUI({
                stage: 'pull',
                message: 'Downloading Docker images',
                progress: 35,
                details: {
                    image: 'kaspanet/kaspad:latest',
                    current: 2,
                    total: 5,
                    size: 524288000,
                    downloaded: 262144000
                }
            });
            updateInstallationStats({
                servicesTotal: 5,
                servicesComplete: 0,
                imagesTotal: 5,
                imagesComplete: 2,
                downloadedBytes: 262144000,
                totalBytes: 524288000,
                elapsedTime: 120
            });
            updateServiceProgress([
                { name: 'kaspa-node', status: 'pulling', progress: 60, message: 'Downloading...' },
                { name: 'postgres', status: 'complete', progress: 100 },
                { name: 'dashboard', status: 'pending' },
                { name: 'nginx', status: 'pending' },
                { name: 'wizard', status: 'pending' }
            ]);
        };

        window.simulateBuild = function() {
            updateInstallationUI({
                stage: 'build',
                message: 'Building custom services',
                progress: 65,
                details: {
                    service: 'dashboard',
                    current: 3,
                    total: 5
                }
            });
            updateInstallationStats({
                servicesTotal: 5,
                servicesComplete: 0,
                imagesTotal: 5,
                imagesComplete: 5,
                elapsedTime: 240
            });
            updateServiceProgress([
                { name: 'kaspa-node', status: 'running', progress: 100 },
                { name: 'postgres', status: 'running', progress: 100 },
                { name: 'dashboard', status: 'building', progress: 75, message: 'Building...' },
                { name: 'nginx', status: 'pending' },
                { name: 'wizard', status: 'pending' }
            ]);
        };

        window.simulateDeploy = function() {
            updateInstallationUI({
                stage: 'deploy',
                message: 'Starting services',
                progress: 85,
                details: {
                    service: 'nginx',
                    current: 4,
                    total: 5
                }
            });
            updateInstallationStats({
                servicesTotal: 5,
                servicesComplete: 3,
                imagesTotal: 5,
                imagesComplete: 5,
                elapsedTime: 360
            });
            updateServiceProgress([
                { name: 'kaspa-node', status: 'running', progress: 100 },
                { name: 'postgres', status: 'running', progress: 100 },
                { name: 'dashboard', status: 'running', progress: 100 },
                { name: 'nginx', status: 'starting', progress: 50, message: 'Starting...' },
                { name: 'wizard', status: 'pending' }
            ]);
        };

        window.simulateValidate = function() {
            updateInstallationUI({
                stage: 'validate',
                message: 'Running health checks',
                progress: 98,
                details: {
                    service: 'kaspa-node',
                    current: 4,
                    total: 5
                }
            });
            updateInstallationStats({
                servicesTotal: 5,
                servicesComplete: 5,
                imagesTotal: 5,
                imagesComplete: 5,
                elapsedTime: 420
            });
            updateServiceProgress([
                { name: 'kaspa-node', status: 'running', progress: 100 },
                { name: 'postgres', status: 'running', progress: 100 },
                { name: 'dashboard', status: 'running', progress: 100 },
                { name: 'nginx', status: 'running', progress: 100 },
                { name: 'wizard', status: 'running', progress: 100 }
            ]);
        };

        window.simulateComplete = function() {
            updateInstallationUI({
                stage: 'validate',
                message: 'Installation complete!',
                progress: 100,
                details: {}
            });
            updateInstallationStats({
                servicesTotal: 5,
                servicesComplete: 5,
                imagesTotal: 5,
                imagesComplete: 5,
                elapsedTime: 450
            });
            updateServiceProgress([
                { name: 'kaspa-node', status: 'running', progress: 100 },
                { name: 'postgres', status: 'running', progress: 100 },
                { name: 'dashboard', status: 'running', progress: 100 },
                { name: 'nginx', status: 'running', progress: 100 },
                { name: 'wizard', status: 'running', progress: 100 }
            ]);
        };

        window.simulateFullInstall = async function() {
            resetProgress();
            await sleep(500);
            simulateInit();
            await sleep(2000);
            simulateConfig();
            await sleep(2000);
            simulatePull();
            await sleep(3000);
            simulateBuild();
            await sleep(3000);
            simulateDeploy();
            await sleep(2000);
            simulateValidate();
            await sleep(2000);
            simulateComplete();
        };

        window.resetProgress = function() {
            const progressBar = document.getElementById('install-progress-bar');
            const progressPercentage = document.getElementById('install-progress-percentage');
            const statusTitle = document.getElementById('install-status-title');
            const statusMessage = document.getElementById('install-status-message');
            const logsText = document.getElementById('install-logs-text');
            const timeEstimate = document.getElementById('install-time-estimate');
            const statsContainer = document.getElementById('install-stats-container');
            const serviceContainer = document.getElementById('service-progress-container');

            if (progressBar) progressBar.style.width = '0%';
            if (progressPercentage) progressPercentage.textContent = '0%';
            if (statusTitle) {
                statusTitle.textContent = 'Initializing...';
                statusTitle.style.color = '';
            }
            if (statusMessage) statusMessage.textContent = 'Preparing installation environment';
            if (logsText) logsText.textContent = 'Waiting for installation to start...';
            if (timeEstimate) timeEstimate.style.display = 'none';
            if (statsContainer) statsContainer.style.display = 'none';
            if (serviceContainer) serviceContainer.innerHTML = '';

            // Reset install steps
            document.querySelectorAll('.install-step').forEach(step => {
                step.classList.remove('active', 'complete');
                step.classList.add('pending');
                step.style.opacity = '0.6';
                step.style.backgroundColor = 'transparent';
                const icon = step.querySelector('.install-step-icon');
                const status = step.querySelector('.install-step-status');
                if (icon) icon.innerHTML = '<span style="opacity: 0.5;">⏳</span>';
                if (status) {
                    status.textContent = 'Pending';
                    status.style.color = '#95a5a6';
                }
            });
        };

        window.toggleLogs = function() {
            const logsContent = document.getElementById('install-logs-content');
            const toggleText = document.getElementById('logs-toggle-text');
            if (logsContent && toggleText) {
                const isHidden = logsContent.style.display === 'none';
                logsContent.style.display = isHidden ? 'block' : 'none';
                toggleText.textContent = isHidden ? 'Hide Details' : 'Show Details';
            }
        };

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        console.log('Enhanced Installation Progress Display Test Page Loaded');
        console.log('Use the buttons on the right to test different scenarios');
    </script>
</body>
</html>
