<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Dialog Test</title>
    <link rel="stylesheet" href="/styles/wizard.css">
    <style>
        body {
            padding: 20px;
            font-family: var(--font-body);
        }
        .test-controls {
            margin-bottom: 20px;
            padding: 20px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
        }
        .test-controls h2 {
            margin-top: 0;
        }
        .test-controls button {
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .test-output {
            padding: 20px;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: var(--font-code);
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-controls">
        <h2>Resume Dialog Test</h2>
        <p>Test the resume installation dialog functionality</p>
        
        <button class="btn-primary" onclick="testResumeDialog()">
            Show Resume Dialog
        </button>
        
        <button class="btn-secondary" onclick="testBackgroundTasks()">
            Show Background Tasks
        </button>
        
        <button class="btn-secondary" onclick="clearOutput()">
            Clear Output
        </button>
    </div>
    
    <div class="test-output" id="output">
        Ready to test...
    </div>
    
    <script type="module">
        import { checkAndShowResumeDialog, displayBackgroundTaskStatus } from './scripts/modules/resume.js';
        
        // Make functions available globally
        window.testResumeDialog = async function() {
            log('Testing resume dialog...');
            
            // Mock resume info
            const mockResumeInfo = {
                canResume: true,
                state: {
                    currentStep: 4,
                    phase: 'preparing',
                    profiles: {
                        selected: ['core', 'kaspa-user-applications']
                    },
                    backgroundTasks: ['node-sync-kaspa-node-123']
                },
                lastActivity: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(), // 2 hours ago
                currentStep: 4,
                phase: 'preparing',
                backgroundTasks: ['node-sync-kaspa-node-123'],
                hoursSinceActivity: 2
            };
            
            log('Mock resume info:', JSON.stringify(mockResumeInfo, null, 2));
            
            // Manually show dialog (since we're mocking)
            const { showResumeDialog } = await import('./scripts/modules/resume.js');
            
            // Create a test version that shows the dialog
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.style.display = 'flex';
            
            const timeSinceActivity = '2 hours ago';
            const stepName = 'Profile Selection';
            const backgroundTasksSummary = '1 task running';
            
            overlay.innerHTML = `
                <div class="modal-content resume-dialog">
                    <div class="resume-header">
                        <div class="resume-icon">üîÑ</div>
                        <h2 class="resume-title">Resume Installation?</h2>
                    </div>
                    
                    <div class="resume-body">
                        <p class="resume-message">
                            An installation is in progress. Would you like to continue where you left off?
                        </p>
                        
                        <div class="resume-details">
                            <div class="resume-detail-item">
                                <div class="detail-icon">üìç</div>
                                <div class="detail-content">
                                    <div class="detail-label">Last Step</div>
                                    <div class="detail-value">${stepName}</div>
                                </div>
                            </div>
                            
                            <div class="resume-detail-item">
                                <div class="detail-icon">‚è±Ô∏è</div>
                                <div class="detail-content">
                                    <div class="detail-label">Last Activity</div>
                                    <div class="detail-value">${timeSinceActivity}</div>
                                </div>
                            </div>
                            
                            <div class="resume-detail-item">
                                <div class="detail-icon">üìä</div>
                                <div class="detail-content">
                                    <div class="detail-label">Installation Phase</div>
                                    <div class="detail-value">Preparing</div>
                                </div>
                            </div>
                            
                            <div class="resume-detail-item">
                                <div class="detail-icon">‚öôÔ∏è</div>
                                <div class="detail-content">
                                    <div class="detail-label">Background Tasks</div>
                                    <div class="detail-value">${backgroundTasksSummary}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="resume-info-box">
                            <div class="info-icon">‚ÑπÔ∏è</div>
                            <div class="info-text">
                                Some tasks are running in the background. Resuming will check their status and continue from where you left off.
                            </div>
                        </div>
                    </div>
                    
                    <div class="resume-actions">
                        <button class="btn-secondary" id="resume-start-over">
                            <span class="btn-icon">üîÑ</span>
                            Start Over
                        </button>
                        <button class="btn-primary" id="resume-continue">
                            Continue Installation
                            <span class="btn-icon">‚Üí</span>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            const continueBtn = overlay.querySelector('#resume-continue');
            const startOverBtn = overlay.querySelector('#resume-start-over');
            
            continueBtn.addEventListener('click', () => {
                log('User chose to continue installation');
                document.body.removeChild(overlay);
            });
            
            startOverBtn.addEventListener('click', () => {
                log('User chose to start over');
                document.body.removeChild(overlay);
            });
            
            log('Resume dialog displayed');
        };
        
        window.testBackgroundTasks = function() {
            log('Testing background tasks display...');
            
            const mockTasks = [
                {
                    id: 'node-sync-kaspa-node-123',
                    service: 'kaspa-node',
                    type: 'node-sync',
                    status: 'in-progress',
                    progress: 45.5
                },
                {
                    id: 'indexer-sync-kasia-456',
                    service: 'kasia-indexer',
                    type: 'indexer-sync',
                    status: 'in-progress',
                    progress: 78.2
                },
                {
                    id: 'database-migration-789',
                    service: 'timescaledb',
                    type: 'database-migration',
                    status: 'complete',
                    progress: 100
                }
            ];
            
            log('Mock background tasks:', JSON.stringify(mockTasks, null, 2));
            
            displayBackgroundTaskStatus(mockTasks);
            
            log('Background tasks displayed');
        };
        
        window.clearOutput = function() {
            document.getElementById('output').textContent = 'Output cleared...';
        };
        
        function log(...args) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            output.textContent += `\n[${timestamp}] ${message}`;
            output.scrollTop = output.scrollHeight;
        }
        
        window.log = log;
        
        log('Test page loaded. Click buttons to test functionality.');
    </script>
</body>
</html>
