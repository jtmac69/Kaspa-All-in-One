# TimescaleDB Configuration for K-Social Indexer (Rust)
# Optimized for Kaspa's 10 blocks/second rate and social media patterns

[database]
enable_timescaledb = true
batch_size = 1000
chunk_interval = "6h"
enable_compression = true
personal_indexer_mode = false

# Hypertable configuration
[hypertables.k_posts]
time_column = "created_at"
chunk_interval = "6 hours"
compression_policy = "24 hours"
retention_policy = "1 year"  # Only if personal_indexer_mode = true

[hypertables.k_votes]
time_column = "created_at"
chunk_interval = "6 hours"
compression_policy = "24 hours"
retention_policy = "1 year"  # Only if personal_indexer_mode = true

[hypertables.k_user_profiles]
time_column = "created_at"
chunk_interval = "1 day"
compression_policy = "7 days"
retention_policy = "2 years"  # Only if personal_indexer_mode = true

[hypertables.k_follows]
time_column = "created_at"
chunk_interval = "1 day"
compression_policy = "24 hours"
retention_policy = "1 year"  # Only if personal_indexer_mode = true

[hypertables.k_transactions]
time_column = "created_at"
chunk_interval = "1 hour"
compression_policy = "24 hours"
retention_policy = "6 months"  # Only if personal_indexer_mode = true

# Continuous aggregates configuration
[continuous_aggregates.hourly_post_stats]
refresh_start_offset = "1 day"
refresh_end_offset = "1 hour"
refresh_schedule_interval = "1 hour"

[continuous_aggregates.daily_user_activity]
refresh_start_offset = "7 days"
refresh_end_offset = "6 hours"
refresh_schedule_interval = "6 hours"

[continuous_aggregates.hourly_vote_stats]
refresh_start_offset = "1 day"
refresh_end_offset = "1 hour"
refresh_schedule_interval = "1 hour"

[continuous_aggregates.daily_follow_stats]
refresh_start_offset = "7 days"
refresh_end_offset = "6 hours"
refresh_schedule_interval = "6 hours"

# Batch processing configuration
[batch_processing]
enabled = true
batch_size = 1000
max_batch_wait_time = 5000  # milliseconds
parallel_batches = 4
retry_attempts = 3
retry_delay = 1000  # milliseconds

# Performance optimization settings
[performance.connection_pool]
min = 2
max = 20
acquire_timeout_millis = 30000
create_timeout_millis = 30000
destroy_timeout_millis = 5000
idle_timeout_millis = 30000

[performance.query_optimization]
enable_prepared_statements = true
enable_query_cache = true
max_query_cache_size = 1000
enable_statement_timeout = true
statement_timeout = 30000

# Personal Indexer configuration
[personal_indexer]
enabled = false  # Set via PERSONAL_INDEXER_MODE env var
user_address = ""  # Set via USER_ADDRESS env var

[personal_indexer.retention]
posts = "2 years"
votes = "1 year"
follows = "1 year"
profiles = "2 years"
transactions = "6 months"

# Monitoring and metrics
[monitoring]
enable_metrics = true
metrics_interval = 60000  # milliseconds
enable_slow_query_logging = true
slow_query_threshold = 1000  # milliseconds
enable_compression_metrics = true
enable_chunk_metrics = true