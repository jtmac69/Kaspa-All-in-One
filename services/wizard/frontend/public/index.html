<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaspa All-in-One Installation Wizard</title>
    
    <!-- Kaspa Brand Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Open+Sans:wght@400;500;600&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Favicons - SVG with PNG fallbacks -->
    <link rel="icon" type="image/svg+xml" href="/assets/brand/icons/svg/kaspa-icon-light.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/brand/icons/png/kaspa-icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/brand/icons/png/kaspa-icon-16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/brand/icons/png/kaspa-icon-180.png">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/styles/wizard.css">
</head>
<body>
    <!-- Wizard Container -->
    <div id="wizard-app" class="wizard-container">
        
        <!-- Progress Indicator -->
        <div class="wizard-progress">
            <div class="progress-steps">
                <div class="progress-step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Welcome</div>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Checklist</div>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">System Check</div>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">Profiles</div>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="5">
                    <div class="step-number">5</div>
                    <div class="step-label">Configure</div>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="6">
                    <div class="step-number">6</div>
                    <div class="step-label">Review</div>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="7">
                    <div class="step-number">7</div>
                    <div class="step-label">Install</div>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="8">
                    <div class="step-number">8</div>
                    <div class="step-label">Complete</div>
                </div>
            </div>
        </div>

        <!-- Test Release Banner -->
        <div class="test-release-banner" id="test-release-banner">
            <div class="banner-icon">‚ö†Ô∏è</div>
            <div class="banner-content">
                <strong>Test Release v0.9.0</strong>
                <p>This is a pre-release version for testing purposes. 
                   <a href="/KNOWN_ISSUES.md" target="_blank">Known Issues</a> | 
                   <a href="https://github.com/kaspa-kcoin/kaspa-all-in-one/issues" target="_blank">Report Bug</a>
                </p>
            </div>
            <button class="banner-dismiss" onclick="dismissBanner()" aria-label="Dismiss banner">√ó</button>
        </div>

        <!-- Main Content Area -->
        <main class="wizard-content">
            
            <!-- Step 1: Welcome -->
            <div class="wizard-step active" id="step-welcome">
                <div class="hero">
                    <!-- Kaspa Logo - Automatically switches for dark mode -->
                    <picture class="hero-logo-container">
                        <source srcset="/assets/brand/logos/svg/kaspa-logo-dark.svg" 
                                media="(prefers-color-scheme: dark)">
                        <img src="/assets/brand/logos/svg/kaspa-logo-light.svg" 
                             alt="Kaspa" 
                             class="hero-logo"
                             onerror="this.closest('.hero-logo-container').style.display='none'; document.querySelector('.hero-logo-placeholder').style.display='block';">
                    </picture>
                    
                    <!-- Placeholder if logo not yet downloaded -->
                    <div class="hero-logo-placeholder" style="display: none;">
                        <div class="logo-placeholder-text">KASPA</div>
                        <div class="logo-placeholder-note">Download logos from https://kaspa.org/media-kit/</div>
                        <div class="logo-placeholder-note">Place in assets/brand/logos/svg/</div>
                    </div>
                    
                    <h1 class="hero-title">Welcome to Kaspa All-in-One</h1>
                    <p class="hero-subtitle">
                        Set up your complete Kaspa ecosystem in minutes with our guided installation wizard
                    </p>
                    
                    <div class="hero-features">
                        <div class="feature-item">
                            <div class="feature-icon">‚ö°</div>
                            <div class="feature-text">Fast Setup</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">üéØ</div>
                            <div class="feature-text">Guided Process</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">‚úÖ</div>
                            <div class="feature-text">Validated</div>
                        </div>
                    </div>
                    
                    <button class="btn-primary btn-large" onclick="nextStep()">
                        Get Started
                        <span class="btn-icon">‚Üí</span>
                    </button>
                    
                    <div class="hero-footer">
                        <a href="https://kaspa.org" target="_blank" class="link-secondary">Learn more about Kaspa</a>
                    </div>
                </div>
            </div>

            <!-- Step 2: Pre-Installation Checklist -->
            <div class="wizard-step" id="step-checklist">
                <div class="step-header">
                    <h2 class="step-title">Pre-Installation Checklist</h2>
                    <p class="step-description">
                        Let's make sure you're ready to install. We'll check what you need and help you get prepared.
                    </p>
                </div>

                <!-- Checklist Progress Summary -->
                <div class="checklist-summary">
                    <div class="summary-card">
                        <div class="summary-icon">üìã</div>
                        <div class="summary-content">
                            <div class="summary-title">Checklist Progress</div>
                            <div class="summary-value"><span id="checklist-completed">0</span> of <span id="checklist-total">5</span> ready</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">‚è±Ô∏è</div>
                        <div class="summary-content">
                            <div class="summary-title">Estimated Time</div>
                            <div class="summary-value" id="estimated-time">Calculating...</div>
                        </div>
                    </div>
                </div>

                <!-- Checklist Items -->
                <div class="checklist-container">
                    
                    <!-- 1. System Requirements -->
                    <div class="checklist-item" data-item="requirements">
                        <div class="checklist-header" onclick="toggleChecklistItem('requirements')">
                            <div class="checklist-status">
                                <div class="status-icon">‚è≥</div>
                                <div class="status-text">Checking...</div>
                            </div>
                            <div class="checklist-title">
                                <h3>System Requirements</h3>
                                <p>Check if your computer has enough resources</p>
                            </div>
                            <div class="checklist-expand">‚ñº</div>
                        </div>
                        <div class="checklist-content">
                            <div class="requirement-checks" id="requirement-checks">
                                <div class="requirement-item">
                                    <div class="requirement-icon">üíª</div>
                                    <div class="requirement-info">
                                        <div class="requirement-name">CPU Cores</div>
                                        <div class="requirement-value" id="cpu-value">Checking...</div>
                                    </div>
                                    <div class="requirement-status" id="cpu-status">‚è≥</div>
                                </div>
                                <div class="requirement-item">
                                    <div class="requirement-icon">üß†</div>
                                    <div class="requirement-info">
                                        <div class="requirement-name">RAM Memory</div>
                                        <div class="requirement-value" id="ram-value">Checking...</div>
                                    </div>
                                    <div class="requirement-status" id="ram-status">‚è≥</div>
                                </div>
                                <div class="requirement-item">
                                    <div class="requirement-icon">üíæ</div>
                                    <div class="requirement-info">
                                        <div class="requirement-name">Disk Space</div>
                                        <div class="requirement-value" id="disk-value">Checking...</div>
                                    </div>
                                    <div class="requirement-status" id="disk-status">‚è≥</div>
                                </div>
                            </div>
                            <div class="checklist-help">
                                <strong>What this means:</strong> We need to make sure your computer is powerful enough to run Kaspa. Don't worry - we'll recommend the best setup for your system.
                            </div>
                        </div>
                    </div>

                    <!-- 2. Docker Installation -->
                    <div class="checklist-item" data-item="docker">
                        <div class="checklist-header" onclick="toggleChecklistItem('docker')">
                            <div class="checklist-status">
                                <div class="status-icon">‚è≥</div>
                                <div class="status-text">Checking...</div>
                            </div>
                            <div class="checklist-title">
                                <h3>Docker Installation</h3>
                                <p>Docker is required to run Kaspa services</p>
                            </div>
                            <div class="checklist-expand">‚ñº</div>
                        </div>
                        <div class="checklist-content">
                            <div class="docker-status" id="docker-status-detail">
                                <p>Checking for Docker installation...</p>
                            </div>
                            <div class="checklist-help">
                                <strong>What is Docker?</strong> Docker is like a container that packages everything Kaspa needs to run. It makes installation much easier and keeps everything organized.
                            </div>
                            <div class="checklist-actions" id="docker-actions" style="display: none;">
                                <button class="btn-secondary btn-small" onclick="showDockerGuide()">
                                    üìñ How to Install Docker
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 3. Docker Compose -->
                    <div class="checklist-item" data-item="compose">
                        <div class="checklist-header" onclick="toggleChecklistItem('compose')">
                            <div class="checklist-status">
                                <div class="status-icon">‚è≥</div>
                                <div class="status-text">Checking...</div>
                            </div>
                            <div class="checklist-title">
                                <h3>Docker Compose</h3>
                                <p>Manages multiple Docker containers together</p>
                            </div>
                            <div class="checklist-expand">‚ñº</div>
                        </div>
                        <div class="checklist-content">
                            <div class="compose-status" id="compose-status-detail">
                                <p>Checking for Docker Compose...</p>
                            </div>
                            <div class="checklist-help">
                                <strong>What is Docker Compose?</strong> This tool helps manage all the different parts of Kaspa at once. It usually comes with Docker Desktop.
                            </div>
                            <div class="checklist-actions" id="compose-actions" style="display: none;">
                                <button class="btn-secondary btn-small" onclick="showComposeGuide()">
                                    üìñ How to Install Docker Compose
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 4. Port Availability -->
                    <div class="checklist-item" data-item="ports">
                        <div class="checklist-header" onclick="toggleChecklistItem('ports')">
                            <div class="checklist-status">
                                <div class="status-icon">‚è≥</div>
                                <div class="status-text">Checking...</div>
                            </div>
                            <div class="checklist-title">
                                <h3>Network Ports</h3>
                                <p>Check if required network ports are available</p>
                            </div>
                            <div class="checklist-expand">‚ñº</div>
                        </div>
                        <div class="checklist-content">
                            <div class="ports-status" id="ports-status-detail">
                                <p>Checking port availability...</p>
                            </div>
                            <div class="checklist-help">
                                <strong>What are ports?</strong> Ports are like doors that let different programs communicate. We need certain ports to be available (not used by other programs).
                            </div>
                        </div>
                    </div>

                    <!-- 5. Help Me Choose Profile -->
                    <div class="checklist-item" data-item="quiz">
                        <div class="checklist-header" onclick="toggleChecklistItem('quiz')">
                            <div class="checklist-status">
                                <div class="status-icon">‚ùì</div>
                                <div class="status-text">Optional</div>
                            </div>
                            <div class="checklist-title">
                                <h3>Help Me Choose</h3>
                                <p>Not sure which profile to install? Take our quick quiz</p>
                            </div>
                            <div class="checklist-expand">‚ñº</div>
                        </div>
                        <div class="checklist-content">
                            <div class="quiz-container" id="quiz-container">
                                <div class="quiz-intro">
                                    <p>Answer a few quick questions and we'll recommend the best setup for you.</p>
                                    <button class="btn-primary btn-small" onclick="startQuiz()">
                                        Start Quiz
                                    </button>
                                </div>
                                <div class="quiz-questions" id="quiz-questions" style="display: none;">
                                    <!-- Quiz questions will be inserted here -->
                                </div>
                                <div class="quiz-result" id="quiz-result" style="display: none;">
                                    <!-- Quiz result will be shown here -->
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Time Estimates -->
                <div class="time-estimates" id="time-estimates" style="display: none;">
                    <h3>What to Expect</h3>
                    <div class="estimate-grid">
                        <div class="estimate-card">
                            <div class="estimate-icon">‚öôÔ∏è</div>
                            <div class="estimate-label">Setup Time</div>
                            <div class="estimate-value" id="setup-time">-</div>
                        </div>
                        <div class="estimate-card">
                            <div class="estimate-icon">‚¨áÔ∏è</div>
                            <div class="estimate-label">Download Size</div>
                            <div class="estimate-value" id="download-size">-</div>
                        </div>
                        <div class="estimate-card">
                            <div class="estimate-icon">üîÑ</div>
                            <div class="estimate-label">Sync Time</div>
                            <div class="estimate-value" id="sync-time">-</div>
                        </div>
                    </div>
                </div>

                <div class="step-actions">
                    <button class="btn-secondary" onclick="previousStep()">
                        <span class="btn-icon">‚Üê</span>
                        Back
                    </button>
                    <button class="btn-primary" onclick="nextStep()" id="checklist-continue">
                        Continue to System Check
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Step 3: System Check -->
            <div class="wizard-step" id="step-system-check">
                <div class="step-header">
                    <h2 class="step-title">System Requirements Check</h2>
                    <p class="step-description">
                        Verifying your system meets the requirements for Kaspa All-in-One
                    </p>
                </div>
                
                <div class="check-results">
                    <div class="check-item checking">
                        <div class="check-icon">
                            <div class="spinner"></div>
                        </div>
                        <div class="check-content">
                            <h3 class="check-title">Docker Installation</h3>
                            <p class="check-message">Checking for Docker...</p>
                        </div>
                        <div class="check-status">Checking</div>
                    </div>
                    
                    <div class="check-item checking">
                        <div class="check-icon">
                            <div class="spinner"></div>
                        </div>
                        <div class="check-content">
                            <h3 class="check-title">Docker Compose</h3>
                            <p class="check-message">Checking for Docker Compose...</p>
                        </div>
                        <div class="check-status">Checking</div>
                    </div>
                    
                    <div class="check-item checking">
                        <div class="check-icon">
                            <div class="spinner"></div>
                        </div>
                        <div class="check-content">
                            <h3 class="check-title">System Resources</h3>
                            <p class="check-message">Checking CPU, RAM, and disk space...</p>
                        </div>
                        <div class="check-status">Checking</div>
                    </div>
                    
                    <div class="check-item checking">
                        <div class="check-icon">
                            <div class="spinner"></div>
                        </div>
                        <div class="check-content">
                            <h3 class="check-title">Port Availability</h3>
                            <p class="check-message">Checking required ports...</p>
                        </div>
                        <div class="check-status">Checking</div>
                    </div>
                </div>
                
                <div class="step-actions">
                    <button class="btn-secondary" onclick="previousStep()">
                        <span class="btn-icon">‚Üê</span>
                        Back
                    </button>
                    <button class="btn-primary" onclick="nextStep()" disabled>
                        Continue
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Step 3: Profile Selection -->
            <div class="wizard-step" id="step-profiles">
                <div class="step-header">
                    <h2 class="step-title">Select Your Deployment Profile</h2>
                    <p class="step-description">
                        Choose which services you want to run. You can select multiple profiles.
                    </p>
                </div>

                <!-- Dependency Warning Container -->
                <div id="dependency-warning" class="warning-banner" style="display: none;">
                    <div class="warning-icon">‚ö†Ô∏è</div>
                    <div class="warning-content">
                        <div class="warning-title">Dependency Warning</div>
                        <div class="warning-message" id="dependency-warning-message"></div>
                    </div>
                </div>

                <!-- Resource Warning Container -->
                <div id="resource-warning" class="warning-banner" style="display: none;">
                    <div class="warning-icon">üíæ</div>
                    <div class="warning-content">
                        <div class="warning-title">Resource Warning</div>
                        <div class="warning-message" id="resource-warning-message"></div>
                    </div>
                </div>

                <!-- Combined Resource Requirements -->
                <div id="combined-resources" class="combined-resources-card" style="display: none;">
                    <h3 class="combined-resources-title">Combined Resource Requirements</h3>
                    <div class="combined-resources-grid">
                        <div class="combined-resource-item">
                            <div class="resource-icon">üíª</div>
                            <div class="resource-info">
                                <div class="resource-label">CPU Cores</div>
                                <div class="resource-value" id="combined-cpu">-</div>
                            </div>
                        </div>
                        <div class="combined-resource-item">
                            <div class="resource-icon">üß†</div>
                            <div class="resource-info">
                                <div class="resource-label">RAM Memory</div>
                                <div class="resource-value" id="combined-ram">-</div>
                            </div>
                        </div>
                        <div class="combined-resource-item">
                            <div class="resource-icon">üíæ</div>
                            <div class="resource-info">
                                <div class="resource-label">Disk Space</div>
                                <div class="resource-value" id="combined-disk">-</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Startup Order Visualization -->
                <div id="startup-order" class="startup-order-card" style="display: none;">
                    <h3 class="startup-order-title">Service Startup Order</h3>
                    <p class="startup-order-description">Services will start in this order based on dependencies:</p>
                    <div class="startup-order-timeline">
                        <div class="startup-phase" id="phase-1" style="display: none;">
                            <div class="phase-number">1</div>
                            <div class="phase-content">
                                <div class="phase-title">Kaspa Node</div>
                                <div class="phase-services" id="phase-1-services"></div>
                            </div>
                        </div>
                        <div class="startup-arrow" id="arrow-1" style="display: none;">‚Üí</div>
                        <div class="startup-phase" id="phase-2" style="display: none;">
                            <div class="phase-number">2</div>
                            <div class="phase-content">
                                <div class="phase-title">Indexer Services</div>
                                <div class="phase-services" id="phase-2-services"></div>
                            </div>
                        </div>
                        <div class="startup-arrow" id="arrow-2" style="display: none;">‚Üí</div>
                        <div class="startup-phase" id="phase-3" style="display: none;">
                            <div class="phase-number">3</div>
                            <div class="phase-content">
                                <div class="phase-title">Applications</div>
                                <div class="phase-services" id="phase-3-services"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="profile-grid">
                    <!-- Core Profile -->
                    <div class="profile-card" data-profile="core">
                        <div class="profile-badge essential">Essential</div>
                        <div class="profile-icon">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                <circle cx="24" cy="24" r="20" stroke="currentColor" stroke-width="3"/>
                                <circle cx="24" cy="24" r="8" fill="currentColor"/>
                            </svg>
                        </div>
                        <h3 class="profile-title">Core Profile</h3>
                        <p class="profile-description">
                            Kaspa node (public/private) with optional wallet
                        </p>
                        <div class="profile-startup-order">
                            <span class="startup-badge">Startup Order: 1</span>
                        </div>
                        <div class="profile-services">
                            <span class="service-tag">kaspa-node</span>
                            <span class="service-tag">wallet</span>
                            <span class="service-tag">dashboard</span>
                            <span class="service-tag">nginx</span>
                        </div>
                        <div class="profile-resources">
                            <div class="resource-item">
                                <span class="resource-label">CPU:</span>
                                <span class="resource-value">2 cores</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">RAM:</span>
                                <span class="resource-value">4 GB</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">Disk:</span>
                                <span class="resource-value">100 GB</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Kaspa User Applications Profile -->
                    <div class="profile-card" data-profile="kaspa-user-applications">
                        <div class="profile-badge popular">Popular</div>
                        <div class="profile-icon">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                <rect x="8" y="8" width="32" height="32" rx="4" stroke="currentColor" stroke-width="3"/>
                                <path d="M16 24 L24 32 L32 16" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h3 class="profile-title">Kaspa User Applications</h3>
                        <p class="profile-description">
                            User-facing apps (Kasia, K-Social, Kaspa Explorer)
                        </p>
                        <div class="profile-startup-order">
                            <span class="startup-badge">Startup Order: 3</span>
                        </div>
                        <div class="profile-services">
                            <span class="service-tag">kasia-app</span>
                            <span class="service-tag">k-social-app</span>
                            <span class="service-tag">kaspa-explorer</span>
                        </div>
                        <div class="profile-resources">
                            <div class="resource-item">
                                <span class="resource-label">CPU:</span>
                                <span class="resource-value">2 cores</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">RAM:</span>
                                <span class="resource-value">4 GB</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">Disk:</span>
                                <span class="resource-value">50 GB</span>
                            </div>
                        </div>
                        <div class="profile-note">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="2"/>
                                <path d="M8 4 L8 8 L11 11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <span>Can use public or local indexers</span>
                        </div>
                    </div>
                    
                    <!-- Indexer Services Profile -->
                    <div class="profile-card" data-profile="indexer-services">
                        <div class="profile-badge advanced">Advanced</div>
                        <div class="profile-icon">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                <circle cx="24" cy="24" r="20" stroke="currentColor" stroke-width="3"/>
                                <circle cx="24" cy="24" r="3" fill="currentColor"/>
                                <line x1="24" y1="4" x2="24" y2="12" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                                <line x1="24" y1="36" x2="24" y2="44" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                                <line x1="4" y1="24" x2="12" y2="24" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                                <line x1="36" y1="24" x2="44" y2="24" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <h3 class="profile-title">Indexer Services</h3>
                        <p class="profile-description">
                            Local indexers (Kasia, K-Indexer, Simply-Kaspa)
                        </p>
                        <div class="profile-startup-order">
                            <span class="startup-badge">Startup Order: 2</span>
                        </div>
                        <div class="profile-services">
                            <span class="service-tag">timescaledb</span>
                            <span class="service-tag">kasia-indexer</span>
                            <span class="service-tag">k-indexer</span>
                            <span class="service-tag">simply-kaspa-indexer</span>
                        </div>
                        <div class="profile-resources">
                            <div class="resource-item">
                                <span class="resource-label">CPU:</span>
                                <span class="resource-value">4 cores</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">RAM:</span>
                                <span class="resource-value">8 GB</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">Disk:</span>
                                <span class="resource-value">500 GB</span>
                            </div>
                        </div>
                        <div class="profile-note">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="2"/>
                                <path d="M8 4 L8 8 L11 11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <span>Shared TimescaleDB with separate databases</span>
                        </div>
                    </div>
                    
                    <!-- Archive Node Profile -->
                    <div class="profile-card" data-profile="archive-node">
                        <div class="profile-badge storage">Storage</div>
                        <div class="profile-icon">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                <rect x="8" y="12" width="32" height="8" rx="2" stroke="currentColor" stroke-width="3"/>
                                <rect x="8" y="24" width="32" height="8" rx="2" stroke="currentColor" stroke-width="3"/>
                                <rect x="8" y="36" width="32" height="8" rx="2" stroke="currentColor" stroke-width="3"/>
                            </svg>
                        </div>
                        <h3 class="profile-title">Archive Node Profile</h3>
                        <p class="profile-description">
                            Non-pruning Kaspa node for complete blockchain history
                        </p>
                        <div class="profile-startup-order">
                            <span class="startup-badge">Startup Order: 1</span>
                        </div>
                        <div class="profile-services">
                            <span class="service-tag">kaspa-archive-node</span>
                        </div>
                        <div class="profile-resources">
                            <div class="resource-item">
                                <span class="resource-label">CPU:</span>
                                <span class="resource-value">8 cores</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">RAM:</span>
                                <span class="resource-value">16 GB</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">Disk:</span>
                                <span class="resource-value">1000 GB</span>
                            </div>
                        </div>
                        <div class="profile-note warning">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M8 3 L8 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                <circle cx="8" cy="12" r="1" fill="currentColor"/>
                                <path d="M8 1 L15 14 L1 14 Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                            </svg>
                            <span>Conflicts with Core Profile</span>
                        </div>
                    </div>
                    
                    <!-- Mining Profile -->
                    <div class="profile-card" data-profile="mining">
                        <div class="profile-badge mining">Mining</div>
                        <div class="profile-icon">
                            <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                <path d="M24 8 L32 20 L24 24 L16 20 Z" stroke="currentColor" stroke-width="3" stroke-linejoin="round"/>
                                <path d="M24 24 L32 20 L32 32 L24 40 Z" stroke="currentColor" stroke-width="3" stroke-linejoin="round"/>
                                <path d="M24 24 L16 20 L16 32 L24 40 Z" stroke="currentColor" stroke-width="3" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h3 class="profile-title">Mining Profile</h3>
                        <p class="profile-description">
                            Local mining stratum pointed to local Kaspa node
                        </p>
                        <div class="profile-startup-order">
                            <span class="startup-badge">Startup Order: 3</span>
                        </div>
                        <div class="profile-services">
                            <span class="service-tag">kaspa-stratum</span>
                        </div>
                        <div class="profile-resources">
                            <div class="resource-item">
                                <span class="resource-label">CPU:</span>
                                <span class="resource-value">2 cores</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">RAM:</span>
                                <span class="resource-value">2 GB</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">Disk:</span>
                                <span class="resource-value">10 GB</span>
                            </div>
                        </div>
                        <div class="profile-note prerequisite">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M8 3 L8 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                <circle cx="8" cy="12" r="1" fill="currentColor"/>
                                <path d="M8 1 L15 14 L1 14 Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                            </svg>
                            <span>Requires Core or Archive Node Profile</span>
                        </div>
                    </div>
                </div>
                
                <!-- Developer Mode Toggle -->
                <div class="developer-mode-section">
                    <div class="developer-mode-card">
                        <div class="developer-mode-header">
                            <div class="developer-mode-icon">
                                <svg width="32" height="32" viewBox="0 0 48 48" fill="none">
                                    <path d="M16 16 L8 24 L16 32" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M32 16 L40 24 L32 32" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="28" y1="12" x2="20" y2="36" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                                </svg>
                            </div>
                            <div class="developer-mode-title-section">
                                <h3 class="developer-mode-title">Developer Mode</h3>
                                <p class="developer-mode-subtitle">Add development tools to your selected profiles</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="developer-mode-toggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="developer-mode-content" id="developer-mode-details" style="display: none;">
                            <p class="developer-mode-description">
                                Developer Mode adds inspection tools and debugging features to your installation:
                            </p>
                            <ul class="developer-mode-features">
                                <li>
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M7 10 L9 12 L13 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    <span><strong>Debug Logging:</strong> Verbose logs for troubleshooting (LOG_LEVEL=debug)</span>
                                </li>
                                <li>
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M7 10 L9 12 L13 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    <span><strong>Portainer:</strong> Docker container management UI (port 9000)</span>
                                </li>
                                <li>
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M7 10 L9 12 L13 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    <span><strong>pgAdmin:</strong> PostgreSQL database management (port 5050)</span>
                                </li>
                                <li>
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M7 10 L9 12 L13 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    <span><strong>Exposed Ports:</strong> Additional service ports for direct access</span>
                                </li>
                                <li>
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M7 10 L9 12 L13 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    <span><strong>Log Access:</strong> Direct access to service logs</span>
                                </li>
                            </ul>
                            <div class="developer-mode-warning">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M10 6 L10 11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <circle cx="10" cy="14" r="1" fill="currentColor"/>
                                    <path d="M10 2 L18 16 L2 16 Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                </svg>
                                <span>Developer Mode increases resource usage and exposes additional ports. Only enable for development environments.</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="step-actions">
                    <button class="btn-secondary" onclick="previousStep()">
                        <span class="btn-icon">‚Üê</span>
                        Back
                    </button>
                    <button class="btn-primary" onclick="nextStep()">
                        Continue
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Step 4: Configure -->
            <div class="wizard-step" id="step-configure">
                <div class="step-header">
                    <h2 class="step-title">Configure Your Services</h2>
                    <p class="step-description">
                        Customize settings for your selected services
                    </p>
                </div>
                
                <div class="config-sections">
                    <div class="config-section">
                        <h3 class="config-section-title">Network Configuration</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label for="external-ip" class="form-label">
                                    External IP Address
                                    <span class="form-tooltip" title="Your public IP address for P2P connections">‚ìò</span>
                                </label>
                                <input type="text" id="external-ip" class="form-input" placeholder="Auto-detect" />
                                <button class="btn-secondary btn-small" onclick="detectExternalIP()">Auto-Detect</button>
                            </div>
                            
                            <div class="form-group">
                                <label for="public-node" class="form-label">
                                    Public Node
                                    <span class="form-tooltip" title="Allow external connections to your node">‚ìò</span>
                                </label>
                                <div class="form-toggle">
                                    <input type="checkbox" id="public-node" class="toggle-input" />
                                    <label for="public-node" class="toggle-label">
                                        <span class="toggle-switch"></span>
                                        <span class="toggle-text">Enable public access</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Indexer Endpoints (Kaspa User Applications profile only) -->
                    <div class="config-section" id="indexer-endpoints-section" style="display: none;">
                        <h3 class="config-section-title">Indexer Endpoints</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label for="kasia-indexer-url" class="form-label">
                                    Kasia Indexer URL
                                    <span class="form-tooltip" title="URL for Kasia indexer API (use local indexer URL if indexer-services profile is selected)">‚ìò</span>
                                </label>
                                <input type="text" id="kasia-indexer-url" class="form-input" placeholder="https://api.kasia.io/" value="https://api.kasia.io/" />
                            </div>
                            
                            <div class="form-group">
                                <label for="ksocial-indexer-url" class="form-label">
                                    K-Social Indexer URL
                                    <span class="form-tooltip" title="URL for K-Social indexer API (use local indexer URL if indexer-services profile is selected)">‚ìò</span>
                                </label>
                                <input type="text" id="ksocial-indexer-url" class="form-input" placeholder="https://indexer0.kaspatalk.net/" value="https://indexer0.kaspatalk.net/" />
                            </div>
                            
                            <div class="form-group">
                                <label for="kaspa-node-ws-url" class="form-label">
                                    Kaspa Node WebSocket URL
                                    <span class="form-tooltip" title="WebSocket URL for Kaspa node connection (use local node URL if core profile is selected)">‚ìò</span>
                                </label>
                                <input type="text" id="kaspa-node-ws-url" class="form-input" placeholder="wss://api.kasia.io/ws" value="wss://api.kasia.io/ws" />
                            </div>
                        </div>
                    </div>
                    
                    <!-- Kaspa Node Configuration (Core/Archive profiles only) -->
                    <div class="config-section" id="kaspa-node-config-section" style="display: none;">
                        <h3 class="config-section-title">Kaspa Node Configuration</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label for="kaspa-network" class="form-label">
                                    Network
                                    <span class="form-tooltip" title="Select mainnet or testnet. Changing networks requires fresh installation.">‚ìò</span>
                                </label>
                                <select id="kaspa-network" class="form-select">
                                    <option value="mainnet" selected>Mainnet</option>
                                    <option value="testnet">Testnet</option>
                                </select>
                                <p class="form-help-text">Current network: <span id="current-network-display">mainnet</span></p>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    Port Configuration
                                    <span class="form-tooltip" title="Configure RPC and P2P ports for the Kaspa node">‚ìò</span>
                                </label>
                                <div class="port-config-display">
                                    <div class="port-display-item">
                                        <span class="port-label">RPC Port:</span>
                                        <span class="port-value" id="rpc-port-display">16110</span>
                                    </div>
                                    <div class="port-display-item">
                                        <span class="port-label">P2P Port:</span>
                                        <span class="port-value" id="p2p-port-display">16111</span>
                                    </div>
                                </div>
                                <button class="btn-secondary btn-small" onclick="openPortConfigModal()">
                                    Configure Ports
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-section">
                        <h3 class="config-section-title">Database Configuration</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label for="k-social-db-password" class="form-label">
                                    K-Social Database Password
                                    <span class="form-tooltip" title="Password for K-Social TimescaleDB database">‚ìò</span>
                                </label>
                                <div class="password-input-group">
                                    <input type="password" id="k-social-db-password" class="form-input" placeholder="Auto-generated" />
                                    <button class="btn-icon-only" onclick="togglePasswordVisibility('k-social-db-password')">
                                        <span class="icon-eye">üëÅ</span>
                                    </button>
                                    <button class="btn-secondary btn-small" onclick="generatePassword('k-social-db-password')">Generate</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="simply-kaspa-db-password" class="form-label">
                                    Simply Kaspa Database Password
                                    <span class="form-tooltip" title="Password for Simply Kaspa TimescaleDB database">‚ìò</span>
                                </label>
                                <div class="password-input-group">
                                    <input type="password" id="simply-kaspa-db-password" class="form-input" placeholder="Auto-generated" />
                                    <button class="btn-icon-only" onclick="togglePasswordVisibility('simply-kaspa-db-password')">
                                        <span class="icon-eye">üëÅ</span>
                                    </button>
                                    <button class="btn-secondary btn-small" onclick="generatePassword('simply-kaspa-db-password')">Generate</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-section">
                        <h3 class="config-section-title">Advanced Options</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="advanced-mode" />
                                    Show advanced configuration options
                                </label>
                            </div>
                            
                            <div id="advanced-options" class="advanced-options" style="display: none;">
                                <!-- Data Directory Configuration (profile-specific) -->
                                <div id="kaspa-data-dir-group" class="form-group" style="display: none;">
                                    <label for="kaspa-data-dir" class="form-label">
                                        Kaspa Node Data Directory
                                        <span class="form-tooltip" title="Container path for Kaspa node data (Docker volume)">‚ìò</span>
                                    </label>
                                    <input type="text" id="kaspa-data-dir" class="form-input" 
                                           placeholder="/data/kaspa" value="/data/kaspa" />
                                    <p class="form-help-text">Default: /data/kaspa</p>
                                </div>
                                
                                <div id="kaspa-archive-data-dir-group" class="form-group" style="display: none;">
                                    <label for="kaspa-archive-data-dir" class="form-label">
                                        Archive Node Data Directory
                                        <span class="form-tooltip" title="Container path for archive node data (requires significant disk space)">‚ìò</span>
                                    </label>
                                    <input type="text" id="kaspa-archive-data-dir" class="form-input" 
                                           placeholder="/data/kaspa-archive" value="/data/kaspa-archive" />
                                    <p class="form-help-text">Default: /data/kaspa-archive (requires significant disk space)</p>
                                </div>
                                
                                <div id="timescaledb-data-dir-group" class="form-group" style="display: none;">
                                    <label for="timescaledb-data-dir" class="form-label">
                                        TimescaleDB Data Directory
                                        <span class="form-tooltip" title="Container path for TimescaleDB data">‚ìò</span>
                                    </label>
                                    <input type="text" id="timescaledb-data-dir" class="form-input" 
                                           placeholder="/data/timescaledb" value="/data/timescaledb" />
                                    <p class="form-help-text">Default: /data/timescaledb</p>
                                </div>
                                
                                <div class="form-group">
                                    <label for="custom-env" class="form-label">
                                        Custom Environment Variables
                                        <span class="form-tooltip" title="Additional environment variables in KEY=value format">‚ìò</span>
                                    </label>
                                    <textarea id="custom-env" class="form-textarea" rows="6" placeholder="KEY=value&#10;ANOTHER_KEY=another_value"></textarea>
                                    <p class="form-help-text">One variable per line in KEY=value format</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="step-actions">
                    <button class="btn-secondary" onclick="previousStep()">
                        <span class="btn-icon">‚Üê</span>
                        Back
                    </button>
                    <button class="btn-primary" onclick="nextStep()">
                        Continue
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Step 5: Review -->
            <div class="wizard-step" id="step-review">
                <div class="step-header">
                    <h2 class="step-title">Review Your Configuration</h2>
                    <p class="step-description">
                        Verify your selections before installation
                    </p>
                </div>
                
                <div class="review-sections">
                    <div class="review-section">
                        <h3 class="review-section-title">Selected Profiles</h3>
                        <div class="review-content">
                            <div class="review-item">
                                <span class="review-label">Profiles:</span>
                                <span class="review-value" id="review-profiles"></span>
                            </div>
                            <div class="review-item">
                                <span class="review-label">Total Services:</span>
                                <span class="review-value" id="review-service-count"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="review-section">
                        <h3 class="review-section-title">Resource Requirements</h3>
                        <div class="review-content">
                            <div class="review-item">
                                <span class="review-label">CPU:</span>
                                <span class="review-value" id="review-cpu"></span>
                            </div>
                            <div class="review-item">
                                <span class="review-label">RAM:</span>
                                <span class="review-value" id="review-ram"></span>
                            </div>
                            <div class="review-item">
                                <span class="review-label">Disk:</span>
                                <span class="review-value" id="review-disk"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="review-section">
                        <h3 class="review-section-title">Network Configuration</h3>
                        <div class="review-content">
                            <div class="review-item">
                                <span class="review-label">External IP:</span>
                                <span class="review-value" id="review-external-ip"></span>
                            </div>
                            <div class="review-item">
                                <span class="review-label">Public Node:</span>
                                <span class="review-value" id="review-public-node"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="review-section warning">
                        <div class="review-warning-icon">‚ö†Ô∏è</div>
                        <div class="review-warning-content">
                            <h4 class="review-warning-title">Before You Continue</h4>
                            <ul class="review-warning-list">
                                <li>Ensure you have sufficient disk space available</li>
                                <li>Initial blockchain sync may take several hours</li>
                                <li>Services will be accessible on localhost by default</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="step-actions">
                    <button class="btn-secondary" onclick="previousStep()">
                        <span class="btn-icon">‚Üê</span>
                        Back
                    </button>
                    <button class="btn-primary" onclick="nextStep()">
                        Start Installation
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Step 6: Install -->
            <div class="wizard-step" id="step-install">
                <div class="step-header">
                    <h2 class="step-title">Installing Kaspa All-in-One</h2>
                    <p class="step-description">
                        Please wait while we set up your services
                    </p>
                </div>
                
                <div class="install-progress">
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-bar-fill" id="install-progress-bar" style="width: 0%"></div>
                        </div>
                        <div class="progress-percentage" id="install-progress-percentage">0%</div>
                    </div>
                    
                    <div class="install-status">
                        <div class="status-icon">
                            <div class="spinner"></div>
                        </div>
                        <div class="status-content">
                            <h3 class="status-title" id="install-status-title">Initializing...</h3>
                            <p class="status-message" id="install-status-message">Preparing installation environment</p>
                        </div>
                    </div>
                    
                    <div class="install-steps">
                        <div class="install-step" data-step="env">
                            <div class="install-step-icon">‚è≥</div>
                            <div class="install-step-content">
                                <h4 class="install-step-title">Creating environment configuration</h4>
                                <p class="install-step-status">Pending</p>
                            </div>
                        </div>
                        
                        <div class="install-step" data-step="pull">
                            <div class="install-step-icon">‚è≥</div>
                            <div class="install-step-content">
                                <h4 class="install-step-title">Pulling Docker images</h4>
                                <p class="install-step-status">Pending</p>
                            </div>
                        </div>
                        
                        <div class="install-step" data-step="start">
                            <div class="install-step-icon">‚è≥</div>
                            <div class="install-step-content">
                                <h4 class="install-step-title">Starting services</h4>
                                <p class="install-step-status">Pending</p>
                            </div>
                        </div>
                        
                        <div class="install-step" data-step="health">
                            <div class="install-step-icon">‚è≥</div>
                            <div class="install-step-content">
                                <h4 class="install-step-title">Running health checks</h4>
                                <p class="install-step-status">Pending</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="install-logs">
                        <div class="logs-header">
                            <h4 class="logs-title">Installation Logs</h4>
                            <button class="btn-secondary btn-small" onclick="toggleLogs()">
                                <span id="logs-toggle-text">Show Details</span>
                            </button>
                        </div>
                        <div class="logs-content" id="install-logs-content" style="display: none;">
                            <pre class="logs-text" id="install-logs-text">Waiting for installation to start...</pre>
                        </div>
                    </div>
                </div>
                
                <div class="step-actions">
                    <button class="btn-secondary" onclick="cancelInstallation()" id="cancel-install-btn">
                        Cancel Installation
                    </button>
                    <button class="btn-primary" onclick="nextStep()" id="install-continue-btn" disabled>
                        Continue
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Step 8: Complete -->
            <div class="wizard-step" id="step-complete">
                <div class="step-header">
                    <div class="completion-icon celebration">
                        <svg width="80" height="80" viewBox="0 0 80 80" fill="none" class="checkmark-svg">
                            <circle cx="40" cy="40" r="38" stroke="#7ED321" stroke-width="4" class="checkmark-circle"/>
                            <path d="M25 40 L35 50 L55 30" stroke="#7ED321" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" class="checkmark-path"/>
                        </svg>
                        <!-- Celebration confetti -->
                        <div class="confetti-container">
                            <div class="confetti"></div>
                            <div class="confetti"></div>
                            <div class="confetti"></div>
                            <div class="confetti"></div>
                            <div class="confetti"></div>
                            <div class="confetti"></div>
                        </div>
                    </div>
                    <h2 class="step-title">üéâ Installation Complete!</h2>
                    <p class="step-description">
                        Your Kaspa All-in-One system is up and running. Let's make sure everything is working perfectly!
                    </p>
                </div>
                
                <!-- Tour Prompt -->
                <div class="tour-prompt">
                    <div class="tour-prompt-content">
                        <div class="tour-prompt-icon">üéØ</div>
                        <div class="tour-prompt-text">
                            <h3>Want a quick tour?</h3>
                            <p>We'll show you around and help you verify everything is working</p>
                        </div>
                    </div>
                    <div class="tour-prompt-actions">
                        <button class="btn-secondary" onclick="skipTour()">Skip for now</button>
                        <button class="btn-primary" onclick="startTour()">
                            Start Tour
                            <span class="btn-icon">‚Üí</span>
                        </button>
                    </div>
                </div>
                
                <div class="completion-sections">
                    <!-- Service Verification Section -->
                    <div class="completion-section" id="service-verification">
                        <div class="section-header">
                            <h3 class="completion-section-title">‚úì Service Verification</h3>
                            <button class="btn-text" onclick="runServiceVerification()">
                                <span class="btn-icon">üîÑ</span> Check Again
                            </button>
                        </div>
                        <p class="section-description">Let's verify all your services are healthy and running correctly</p>
                        
                        <div class="verification-status" id="verification-status">
                            <div class="verification-progress">
                                <div class="spinner-small"></div>
                                <span>Checking services...</span>
                            </div>
                        </div>
                        
                        <div class="service-status-list" id="service-status-list" style="display: none;">
                            <!-- Services will be populated dynamically -->
                        </div>
                        
                        <div class="verification-summary" id="verification-summary" style="display: none;">
                            <div class="summary-badge success">
                                <span class="badge-icon">‚úì</span>
                                <span class="badge-text">All services healthy</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Getting Started Guide -->
                    <div class="completion-section" id="getting-started">
                        <h3 class="completion-section-title">üöÄ What Now? Getting Started</h3>
                        <p class="section-description">Here's what you can do with your new Kaspa system</p>
                        
                        <div class="getting-started-grid">
                            <div class="guide-card" data-tour-target="dashboard">
                                <div class="guide-card-header">
                                    <div class="guide-card-icon">üìä</div>
                                    <h4 class="guide-card-title">Monitor Your System</h4>
                                </div>
                                <p class="guide-card-description">
                                    Use the dashboard to check service health, view logs, and monitor your node's sync progress
                                </p>
                                <div class="guide-card-actions">
                                    <button class="btn-link" onclick="openDashboard()">Open Dashboard ‚Üí</button>
                                    <button class="btn-text" onclick="startDashboardTour()">Take a tour</button>
                                </div>
                            </div>
                            
                            <div class="guide-card">
                                <div class="guide-card-header">
                                    <div class="guide-card-icon">‚è±Ô∏è</div>
                                    <h4 class="guide-card-title">Wait for Sync</h4>
                                </div>
                                <p class="guide-card-description">
                                    Your Kaspa node is syncing with the network. This typically takes 2-6 hours depending on your connection
                                </p>
                                <div class="guide-card-tip">
                                    <strong>Tip:</strong> You can monitor sync progress in the dashboard. The node is ready when it shows "Synced"
                                </div>
                            </div>
                            
                            <div class="guide-card">
                                <div class="guide-card-header">
                                    <div class="guide-card-icon">üîß</div>
                                    <h4 class="guide-card-title">Manage Services</h4>
                                </div>
                                <p class="guide-card-description">
                                    Start, stop, or restart services as needed. Each service can be controlled independently
                                </p>
                                <div class="guide-card-actions">
                                    <button class="btn-text" onclick="showServiceManagementGuide()">Learn how ‚Üí</button>
                                </div>
                            </div>
                            
                            <div class="guide-card">
                                <div class="guide-card-header">
                                    <div class="guide-card-icon">üìö</div>
                                    <h4 class="guide-card-title">Learn More</h4>
                                </div>
                                <p class="guide-card-description">
                                    Explore documentation, watch video tutorials, and join the community
                                </p>
                                <div class="guide-card-actions">
                                    <button class="btn-text" onclick="showResourcesModal()">View resources ‚Üí</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="completion-section">
                        <h3 class="completion-section-title">‚ö° Quick Actions</h3>
                        <div class="quick-actions-grid">
                            <button class="action-card" onclick="openDashboard()">
                                <div class="action-card-icon">üìä</div>
                                <div class="action-card-content">
                                    <h4 class="action-card-title">Open Dashboard</h4>
                                    <p class="action-card-description">Monitor and control services</p>
                                </div>
                                <span class="action-card-arrow">‚Üí</span>
                            </button>
                            
                            <button class="action-card" onclick="checkSyncStatus()">
                                <div class="action-card-icon">üîÑ</div>
                                <div class="action-card-content">
                                    <h4 class="action-card-title">Check Sync Status</h4>
                                    <p class="action-card-description">See blockchain sync progress</p>
                                </div>
                                <span class="action-card-arrow">‚Üí</span>
                            </button>
                            
                            <button class="action-card" onclick="viewLogs()">
                                <div class="action-card-icon">üìù</div>
                                <div class="action-card-content">
                                    <h4 class="action-card-title">View Logs</h4>
                                    <p class="action-card-description">Check service logs</p>
                                </div>
                                <span class="action-card-arrow">‚Üí</span>
                            </button>
                            
                            <button class="action-card" onclick="showResourcesModal()">
                                <div class="action-card-icon">üìö</div>
                                <div class="action-card-content">
                                    <h4 class="action-card-title">Documentation</h4>
                                    <p class="action-card-description">Learn more about Kaspa</p>
                                </div>
                                <span class="action-card-arrow">‚Üí</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Help & Support -->
                    <div class="completion-section">
                        <h3 class="completion-section-title">üí¨ Need Help?</h3>
                        <div class="help-options">
                            <a href="https://discord.gg/kaspa" target="_blank" class="help-option">
                                <div class="help-option-icon">üí¨</div>
                                <div class="help-option-content">
                                    <h4>Join Discord</h4>
                                    <p>Get help from the community</p>
                                </div>
                            </a>
                            <a href="https://kaspa.org/docs" target="_blank" class="help-option">
                                <div class="help-option-icon">üìñ</div>
                                <div class="help-option-content">
                                    <h4>Read Docs</h4>
                                    <p>Comprehensive guides and tutorials</p>
                                </div>
                            </a>
                            <a href="https://github.com/kaspanet" target="_blank" class="help-option">
                                <div class="help-option-icon">üêõ</div>
                                <div class="help-option-content">
                                    <h4>Report Issue</h4>
                                    <p>Found a bug? Let us know</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="step-actions">
                    <button class="btn-secondary" onclick="restartWizard()">
                        <span class="btn-icon">‚Ü∫</span> Run Wizard Again
                    </button>
                    <button class="btn-primary btn-large" onclick="openDashboard()">
                        Open Dashboard
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>
            
        </main>

        <!-- Footer -->
        <footer class="wizard-footer">
            <div class="footer-content">
                <div class="footer-logo">
                    <picture>
                        <source srcset="/assets/brand/icons/svg/kaspa-icon-dark.svg" 
                                media="(prefers-color-scheme: dark)">
                        <img src="/assets/brand/icons/svg/kaspa-icon-light.svg" 
                             alt="Kaspa" 
                             class="footer-logo-img">
                    </picture>
                    <span class="footer-text">Kaspa All-in-One</span>
                </div>
                <div class="footer-actions">
                    <button class="btn-footer btn-report-bug" onclick="window.open('https://github.com/kaspa-kcoin/kaspa-all-in-one/issues/new?template=bug_report.md', '_blank')">
                        üêõ Report Bug
                    </button>
                    <button class="btn-footer btn-suggest-feature" onclick="window.open('https://github.com/kaspa-kcoin/kaspa-all-in-one/issues/new?template=feature_request.md', '_blank')">
                        üí° Suggest Feature
                    </button>
                    <button class="btn-footer btn-known-issues" onclick="window.open('/KNOWN_ISSUES.md', '_blank')">
                        üìã View Known Issues
                    </button>
                </div>
                <div class="footer-links">
                    <a href="https://kaspa.org" target="_blank">kaspa.org</a>
                    <a href="https://github.com/kaspanet" target="_blank">GitHub</a>
                    <a href="https://discord.gg/kaspa" target="_blank">Discord</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Safety Confirmation Modal -->
    <div id="safety-confirmation-modal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="safety.handleConfirmationAction('cancel')"></div>
        <div class="modal-content safety-confirmation-content">
            <div class="modal-header">
                <h2>Confirmation Required</h2>
                <button class="modal-close" onclick="safety.handleConfirmationAction('cancel')">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Safety confirmation content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Installation Guide Modal -->
    <div id="installation-guide-modal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeInstallationGuide()"></div>
        <div class="modal-content installation-guide-content">
            <div class="modal-header">
                <h2 id="guide-title">Installation Guide</h2>
                <button class="modal-close" onclick="closeInstallationGuide()">√ó</button>
            </div>
            <div class="modal-body" id="guide-body">
                <!-- Guide content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Error Remediation Modal -->
    <div id="error-remediation-modal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="errorRemediation.closeRemediationModal()"></div>
        <div class="modal-content remediation-content">
            <div class="modal-header">
                <h2 id="remediation-title">Error - Auto-Fix Available</h2>
                <button class="modal-close" onclick="errorRemediation.closeRemediationModal()">√ó</button>
            </div>
            <div class="modal-body" id="remediation-body">
                <!-- Remediation content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Interactive Tour Modal -->
    <div id="tour-modal" class="modal tour-modal" style="display: none;">
        <div class="modal-overlay" onclick="closeTour()"></div>
        <div class="modal-content tour-content">
            <div class="modal-header">
                <div class="tour-progress">
                    <span class="tour-step-indicator">Step <span id="tour-current-step">1</span> of <span id="tour-total-steps">5</span></span>
                </div>
                <button class="modal-close" onclick="closeTour()">√ó</button>
            </div>
            <div class="modal-body tour-body" id="tour-body">
                <!-- Tour content will be inserted here -->
            </div>
            <div class="modal-footer tour-footer">
                <button class="btn-text" onclick="skipTour()">Skip Tour</button>
                <div class="tour-navigation">
                    <button class="btn-secondary" id="tour-prev-btn" onclick="previousTourStep()" disabled>
                        <span class="btn-icon">‚Üê</span> Previous
                    </button>
                    <button class="btn-primary" id="tour-next-btn" onclick="nextTourStep()">
                        Next <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Resources Modal -->
    <div id="resources-modal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeResourcesModal()"></div>
        <div class="modal-content resources-content">
            <div class="modal-header">
                <h2>üìö Resources & Documentation</h2>
                <button class="modal-close" onclick="closeResourcesModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="resources-grid">
                    <div class="resource-category">
                        <h3 class="resource-category-title">üìñ Documentation</h3>
                        <div class="resource-links">
                            <a href="https://kaspa.org/docs" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üìÑ</span>
                                <span class="resource-link-text">Official Documentation</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="https://github.com/kaspanet" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üíª</span>
                                <span class="resource-link-text">GitHub Repository</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="./docs/README.md" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üìã</span>
                                <span class="resource-link-text">Local Documentation</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                        </div>
                    </div>
                    
                    <div class="resource-category">
                        <h3 class="resource-category-title">üé• Video Tutorials</h3>
                        <div class="resource-links">
                            <a href="https://youtube.com/@kaspa" target="_blank" class="resource-link">
                                <span class="resource-link-icon">‚ñ∂Ô∏è</span>
                                <span class="resource-link-text">Getting Started Video</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="https://youtube.com/@kaspa" target="_blank" class="resource-link">
                                <span class="resource-link-icon">‚ñ∂Ô∏è</span>
                                <span class="resource-link-text">Dashboard Overview</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="https://youtube.com/@kaspa" target="_blank" class="resource-link">
                                <span class="resource-link-icon">‚ñ∂Ô∏è</span>
                                <span class="resource-link-text">Troubleshooting Guide</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                        </div>
                    </div>
                    
                    <div class="resource-category">
                        <h3 class="resource-category-title">üí¨ Community</h3>
                        <div class="resource-links">
                            <a href="https://discord.gg/kaspa" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üí¨</span>
                                <span class="resource-link-text">Discord Community</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="https://reddit.com/r/kaspa" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üó®Ô∏è</span>
                                <span class="resource-link-text">Reddit Community</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="https://t.me/kaspaenglish" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üì±</span>
                                <span class="resource-link-text">Telegram Group</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                        </div>
                    </div>
                    
                    <div class="resource-category">
                        <h3 class="resource-category-title">üîß Tools & Utilities</h3>
                        <div class="resource-links">
                            <a href="http://localhost:3000" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üìä</span>
                                <span class="resource-link-text">Management Dashboard</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="https://explorer.kaspa.org" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üîç</span>
                                <span class="resource-link-text">Block Explorer</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="https://kaspa.org/tools" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üõ†Ô∏è</span>
                                <span class="resource-link-text">More Tools</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tour Spotlight Overlay -->
    <div id="tour-spotlight" class="tour-spotlight" style="display: none;">
        <div class="spotlight-overlay"></div>
        <div class="spotlight-target"></div>
        <div class="spotlight-tooltip">
            <div class="tooltip-content" id="spotlight-tooltip-content"></div>
            <div class="tooltip-arrow"></div>
        </div>
    </div>

    <!-- Floating Help/Glossary Button -->
    <button class="floating-help-button" onclick="showGlossaryModal()" title="Open Glossary & Help">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
    </button>

    <!-- Rollback UI Components -->
    
    <!-- Start Over Button -->
    <button id="start-over-button" class="start-over-button" onclick="confirmStartOver()" title="Start over from beginning">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
            <path d="M3 3v5h5"/>
        </svg>
        Start Over
    </button>

    <!-- Version History Modal -->
    <div id="version-history-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configuration History</h2>
                <button class="modal-close" onclick="closeVersionHistoryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-description">
                    View and restore previous configuration versions. Each time you make changes, 
                    a version is automatically saved so you can roll back if needed.
                </p>
                <div id="version-history-list" class="version-history-list">
                    <p class="loading">Loading version history...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeVersionHistoryModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Start Over Confirmation Modal -->
    <div id="start-over-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîÑ Start Over?</h2>
                <button class="modal-close" onclick="closeStartOverModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p class="warning-message">
                    This will reset the wizard and clear your current progress.
                </p>
                <div class="warning-details">
                    <h4>What will happen:</h4>
                    <ul>
                        <li>All wizard progress will be lost</li>
                        <li>Configuration selections will be cleared</li>
                        <li>You will return to the welcome screen</li>
                    </ul>
                    <h4>What won't be affected:</h4>
                    <ul>
                        <li>Running services will continue</li>
                        <li>Existing data will be preserved</li>
                        <li>Configuration backups will be kept</li>
                    </ul>
                </div>
                <div class="start-over-options">
                    <label>
                        <input type="checkbox" id="delete-data-checkbox">
                        Also remove all containers and volumes
                    </label>
                    <label>
                        <input type="checkbox" id="delete-config-checkbox">
                        Also delete configuration files
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeStartOverModal()">Cancel</button>
                <button class="btn-danger" onclick="executeStartOver()">Start Over</button>
            </div>
        </div>
    </div>

    <!-- Error Recovery Dialog -->
    <div id="error-recovery-dialog" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ö†Ô∏è Installation Error</h2>
                <button class="modal-close" onclick="closeErrorRecoveryDialog()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="error-details">
                    <p><strong>Stage:</strong> <span class="error-stage"></span></p>
                    <p><strong>Error:</strong> <span class="error-message"></span></p>
                </div>
                <h4>Recovery Options:</h4>
                <div class="recovery-options">
                    <button class="btn-primary" onclick="retryInstallation()">
                        üîÑ Retry Installation
                    </button>
                    <button class="btn-secondary" onclick="window.rollback.undoLastChange()">
                        ‚Ü∂ Undo Last Change
                    </button>
                    <button class="btn-secondary" onclick="window.rollback.showVersionHistoryModal()">
                        üìã View Version History
                    </button>
                    <button class="btn-secondary" onclick="showDiagnosticExport()">
                        üìä Export Diagnostic Report
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeErrorRecoveryDialog()">Close</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script type="module" src="/scripts/wizard-refactored.js?v=4"></script>
    <script src="/scripts/glossary.js?v=4"></script>
    
    <!-- Rollback UI Helper Functions -->
    <script>
        // Modal management functions
        function closeVersionHistoryModal() {
            document.getElementById('version-history-modal').style.display = 'none';
        }
        
        function closeStartOverModal() {
            document.getElementById('start-over-modal').style.display = 'none';
        }
        
        function closeErrorRecoveryDialog() {
            document.getElementById('error-recovery-dialog').style.display = 'none';
        }
        
        // Start over confirmation
        function confirmStartOver() {
            document.getElementById('start-over-modal').style.display = 'block';
        }
        
        // Execute start over
        async function executeStartOver() {
            const deleteData = document.getElementById('delete-data-checkbox').checked;
            const deleteConfig = document.getElementById('delete-config-checkbox').checked;
            
            closeStartOverModal();
            
            if (window.rollback) {
                await window.rollback.startOver({
                    deleteData,
                    deleteConfig,
                    deleteBackups: false
                });
            }
        }
        
        // Retry installation
        function retryInstallation() {
            closeErrorRecoveryDialog();
            if (window.wizard) {
                window.wizard.startInstallation();
            }
        }
        
        // Show diagnostic export
        function showDiagnosticExport() {
            closeErrorRecoveryDialog();
            // This will be handled by diagnostic module
            if (window.diagnostic) {
                window.diagnostic.showExportDialog();
            }
        }
        
        // Undo button removed - users can use Back button to change configuration
        // Rollback functionality preserved for post-installation use
        
        // Start Over - simple localStorage clear and reload
        function confirmStartOver() {
            const confirmed = confirm(
                'This will reset the wizard and clear all your selections. ' +
                'Are you sure you want to start over?'
            );
            
            if (confirmed) {
                // Clear all localStorage
                localStorage.clear();
                // Set wizard version to prevent re-clearing on reload
                localStorage.setItem('wizardVersion', '3');
                // Reload page with ?mode=initial to force initial installation mode
                window.location.href = window.location.pathname + '?mode=initial';
            }
        }
        
        // Port Configuration Modal Functions
        function openPortConfigModal() {
            const modal = document.getElementById('port-config-modal');
            if (modal) {
                modal.style.display = 'flex';
                // Load current values
                const rpcPort = document.getElementById('rpc-port-display').textContent;
                const p2pPort = document.getElementById('p2p-port-display').textContent;
                document.getElementById('rpc-port-input').value = rpcPort;
                document.getElementById('p2p-port-input').value = p2pPort;
            }
        }
        
        function closePortConfigModal() {
            const modal = document.getElementById('port-config-modal');
            if (modal) {
                modal.style.display = 'none';
                // Clear validation errors
                clearPortValidationErrors();
            }
        }
        
        function clearPortValidationErrors() {
            const errorElements = document.querySelectorAll('.port-error-message');
            errorElements.forEach(el => el.remove());
            
            const inputs = document.querySelectorAll('.port-input');
            inputs.forEach(input => input.classList.remove('input-error'));
        }
        
        function resetPortsToDefaults() {
            document.getElementById('rpc-port-input').value = '16110';
            document.getElementById('p2p-port-input').value = '16111';
            clearPortValidationErrors();
        }
        
        async function savePortConfiguration() {
            const rpcPort = parseInt(document.getElementById('rpc-port-input').value);
            const p2pPort = parseInt(document.getElementById('p2p-port-input').value);
            
            // Clear previous errors
            clearPortValidationErrors();
            
            // Validate ports
            let hasErrors = false;
            
            // Validate RPC port
            if (isNaN(rpcPort) || rpcPort < 1024 || rpcPort > 65535) {
                showPortError('rpc-port-input', 'Port must be between 1024 and 65535');
                hasErrors = true;
            }
            
            // Validate P2P port
            if (isNaN(p2pPort) || p2pPort < 1024 || p2pPort > 65535) {
                showPortError('p2p-port-input', 'Port must be between 1024 and 65535');
                hasErrors = true;
            }
            
            // Check for port conflict
            if (!hasErrors && rpcPort === p2pPort) {
                showPortError('p2p-port-input', 'P2P port must be different from RPC port');
                hasErrors = true;
            }
            
            if (hasErrors) {
                return;
            }
            
            // Update display values
            document.getElementById('rpc-port-display').textContent = rpcPort;
            document.getElementById('p2p-port-display').textContent = p2pPort;
            
            // Store in state (will be handled by configure module)
            if (window.stateManager) {
                const config = window.stateManager.get('configuration') || {};
                config.KASPA_NODE_RPC_PORT = rpcPort;
                config.KASPA_NODE_P2P_PORT = p2pPort;
                window.stateManager.set('configuration', config);
            }
            
            // Close modal
            closePortConfigModal();
            
            // Show success notification
            if (window.showNotification) {
                window.showNotification('Port configuration saved', 'success');
            }
        }
        
        function showPortError(inputId, message) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            input.classList.add('input-error');
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'port-error-message';
            errorDiv.textContent = message;
            input.parentElement.appendChild(errorDiv);
        }
        
        // Network Change Warning Functions
        function openNetworkChangeWarning(newNetwork) {
            const modal = document.getElementById('network-change-warning-modal');
            if (modal) {
                document.getElementById('new-network-name').textContent = newNetwork;
                modal.style.display = 'flex';
            }
        }
        
        function closeNetworkChangeWarning() {
            const modal = document.getElementById('network-change-warning-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function cancelNetworkChange() {
            // Revert to previous network selection
            const currentNetwork = document.getElementById('current-network-display').textContent;
            document.getElementById('kaspa-network').value = currentNetwork;
            closeNetworkChangeWarning();
        }
        
        function confirmNetworkChange() {
            const newNetwork = document.getElementById('kaspa-network').value;
            document.getElementById('current-network-display').textContent = newNetwork;
            
            // Store in state
            if (window.stateManager) {
                const config = window.stateManager.get('configuration') || {};
                config.KASPA_NETWORK = newNetwork;
                window.stateManager.set('configuration', config);
            }
            
            closeNetworkChangeWarning();
            
            // Show notification
            if (window.showNotification) {
                window.showNotification(`Network changed to ${newNetwork}. Fresh installation recommended.`, 'warning', 5000);
            }
        }
    </script>
    
    <!-- Port Configuration Modal -->
    <div id="port-config-modal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closePortConfigModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Configure Kaspa Node Ports</h3>
                <button class="modal-close" onclick="closePortConfigModal()" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-description">
                    Configure the ports used by the Kaspa node for RPC and P2P connections.
                </p>
                
                <div class="form-group">
                    <label for="rpc-port-input" class="form-label">
                        RPC Port
                        <span class="form-tooltip" title="Port for RPC API connections">‚ìò</span>
                    </label>
                    <input type="number" id="rpc-port-input" class="form-input port-input" 
                           value="16110" min="1024" max="65535" />
                    <p class="form-help-text">Default: 16110</p>
                </div>
                
                <div class="form-group">
                    <label for="p2p-port-input" class="form-label">
                        P2P Port
                        <span class="form-tooltip" title="Port for peer-to-peer connections">‚ìò</span>
                    </label>
                    <input type="number" id="p2p-port-input" class="form-input port-input" 
                           value="16111" min="1024" max="65535" />
                    <p class="form-help-text">Default: 16111</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="resetPortsToDefaults()">
                    Reset to Defaults
                </button>
                <div class="modal-footer-actions">
                    <button class="btn-secondary" onclick="closePortConfigModal()">
                        Cancel
                    </button>
                    <button class="btn-primary" onclick="savePortConfiguration()">
                        Save Configuration
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Network Change Warning Modal -->
    <div id="network-change-warning-modal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeNetworkChangeWarning()"></div>
        <div class="modal-content modal-warning">
            <div class="modal-header">
                <div class="modal-warning-icon">‚ö†Ô∏è</div>
                <h3 class="modal-title">Network Change Warning</h3>
                <button class="modal-close" onclick="closeNetworkChangeWarning()" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-description">
                    You are about to change the Kaspa network to <strong id="new-network-name">testnet</strong>.
                </p>
                
                <div class="warning-box">
                    <h4>‚ö†Ô∏è Important Information</h4>
                    <ul>
                        <li><strong>Data Incompatibility:</strong> Mainnet and testnet data are not compatible</li>
                        <li><strong>Fresh Installation Required:</strong> Changing networks requires a fresh installation</li>
                        <li><strong>Existing Data:</strong> Any existing blockchain data will not work with the new network</li>
                    </ul>
                </div>
                
                <p class="modal-description">
                    If you have an existing installation, you should perform a fresh installation after changing the network.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="cancelNetworkChange()">
                    Cancel
                </button>
                <button class="btn-primary btn-warning" onclick="confirmNetworkChange()">
                    Change Network
                </button>
            </div>
        </div>
    </div>
</body>
</html>
