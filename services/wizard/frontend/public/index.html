<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaspa All-in-One Installation Wizard</title>
    
    <!-- Kaspa Brand Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Open+Sans:wght@400;500;600&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Favicons - SVG with PNG fallbacks -->
    <link rel="icon" type="image/svg+xml" href="/assets/brand/icons/svg/kaspa-icon-light.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/brand/icons/png/kaspa-icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/brand/icons/png/kaspa-icon-16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/brand/icons/png/kaspa-icon-180.png">

    <!-- FOUC prevention: apply theme before stylesheets render -->
    <script>
    (function(){
      var s=localStorage.getItem('kaspa-aio-theme');
      var t=(s==='light'||s==='dark')?s:
        (window.matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light');
      document.documentElement.setAttribute('data-theme',t);
      document.documentElement.setAttribute('data-theme-preference',s||'system');
    })();
    </script>

    <!-- Styles -->
    <link rel="stylesheet" href="/shared/styles/theme-toggle.css">
    <link rel="stylesheet" href="/styles/wizard.css">
    <link rel="stylesheet" href="/styles/error-display.css">
    <link rel="stylesheet" href="/styles/wallet.css">
</head>
<body>
    <!-- Wizard Container -->
    <div id="wizard-app" class="wizard-container">

        <!-- Sidebar + Main Content Layout -->
        <div class="wizard-layout">

        <!-- Sidebar Navigation (was Progress Indicator) -->
        <div class="wizard-progress">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <picture>
                    <source srcset="/assets/brand/icons/svg/kaspa-icon-dark.svg" media="(prefers-color-scheme: dark)">
                    <img src="/assets/brand/icons/svg/kaspa-icon-light.svg" alt="Kaspa" class="sidebar-logo">
                </picture>
                <span class="sidebar-title">Kaspa AIO</span>
            </div>
            <div class="progress-steps">
                <div class="progress-step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Welcome</div>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Checklist</div>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">System Check</div>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">Templates</div>
                </div>
                <div class="progress-line"></div>
                <!-- Profiles step - only shown when in custom mode -->
                <div class="progress-step optional-step" data-step="5" id="profiles-progress-step" style="display: none;">
                    <div class="step-number">5</div>
                    <div class="step-label">Profiles</div>
                </div>
                <div class="progress-line optional-line" id="profiles-progress-line" style="display: none;"></div>
                <div class="progress-step" data-step="6">
                    <div class="step-number">6</div>
                    <div class="step-label">Configure</div>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="7">
                    <div class="step-number">7</div>
                    <div class="step-label">Review</div>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="8">
                    <div class="step-number">8</div>
                    <div class="step-label">Install</div>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="9">
                    <div class="step-number">9</div>
                    <div class="step-label">Complete</div>
                </div>
            </div>
            <!-- Sidebar Reconfiguration Panel (hidden by default) -->
            <div class="sidebar-reconfig-panel" id="sidebar-reconfig-panel">
                <div class="sidebar-reconfig-mode-label">Reconfiguration</div>
                <div class="sidebar-install-summary" id="sidebar-install-summary">
                    <div>Loading...</div>
                </div>
                <nav class="sidebar-reconfig-nav">
                    <button class="sidebar-nav-btn" data-action="manage-services" onclick="selectReconfigurationAction('add-profiles')">
                        <span class="sidebar-nav-icon">üì¶</span> Manage Services
                    </button>
                    <button class="sidebar-nav-btn" data-action="edit-settings" onclick="startModifySettings()">
                        <span class="sidebar-nav-icon">‚öôÔ∏è</span> Edit Settings
                    </button>
                    <button class="sidebar-nav-btn" data-action="dashboard" onclick="window.location.href='/dashboard'">
                        <span class="sidebar-nav-icon">üìä</span> Dashboard
                    </button>
                </nav>
                <button class="sidebar-exit-reconfig" onclick="exitReconfigurationMode()">
                    ‚Üê Exit Reconfiguration
                </button>
            </div>

            <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme" title="Toggle theme">
                <svg class="theme-icon theme-icon-light" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                <svg class="theme-icon theme-icon-dark" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                <svg class="theme-icon theme-icon-system" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
            </button>
        </div>

        <!-- Main Content Panel -->
        <div class="wizard-main">

        <!-- Main Content Area -->
        <main class="wizard-content">
            
            <!-- Step 1: Welcome -->
            <div class="wizard-step active" id="step-welcome">
                <div class="hero">
                    <!-- Kaspa Logo - Automatically switches for dark mode -->
                    <picture class="hero-logo-container">
                        <source srcset="/assets/brand/logos/svg/kaspa-logo-dark.svg" 
                                media="(prefers-color-scheme: dark)">
                        <img src="/assets/brand/logos/svg/kaspa-logo-light.svg" 
                             alt="Kaspa" 
                             class="hero-logo"
                             onerror="this.closest('.hero-logo-container').style.display='none'; document.querySelector('.hero-logo-placeholder').style.display='block';">
                    </picture>
                    
                    <!-- Placeholder if logo not yet downloaded -->
                    <div class="hero-logo-placeholder" style="display: none;">
                        <div class="logo-placeholder-text">KASPA</div>
                        <div class="logo-placeholder-note">Download logos from https://kaspa.org/media-kit/</div>
                        <div class="logo-placeholder-note">Place in assets/brand/logos/svg/</div>
                    </div>
                    
                    <h1 class="hero-title">Welcome to Kaspa All-in-One</h1>
                    <p class="hero-subtitle">
                        Set up your complete Kaspa ecosystem in minutes with our guided installation wizard
                    </p>
                    
                    <div class="hero-features">
                        <div class="feature-item">
                            <div class="feature-icon">‚ö°</div>
                            <div class="feature-text">Fast Setup</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">üéØ</div>
                            <div class="feature-text">Guided Process</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">‚úÖ</div>
                            <div class="feature-text">Validated</div>
                        </div>
                    </div>
                    
                    <button class="btn-primary btn-large" onclick="nextStep()">
                        Get Started
                        <span class="btn-icon">‚Üí</span>
                    </button>
                    
                    <div class="hero-footer">
                        <a href="https://kaspa.org" target="_blank" class="link-secondary">Learn more about Kaspa</a>
                    </div>
                </div>
            </div>

            <!-- Step 1.5: Reconfiguration Landing (only shown in reconfiguration mode) -->
            <div class="wizard-step" id="step-reconfigure-landing" style="display: none;">
                <div class="step-header">
                    <h2 class="step-title">Reconfigure Your Installation</h2>
                    <p class="step-description">
                        Modify your existing Kaspa All-in-One installation by adding profiles, changing settings, or removing services.
                    </p>
                </div>

                <!-- Current Installation Summary -->
                <div class="current-installation-summary">
                    <div class="summary-header">
                        <div class="summary-icon">üìä</div>
                        <div class="summary-content">
                            <h3 class="summary-title">Current Installation 
                                <span class="help-icon" data-tooltip="Overview of your current Kaspa installation including installed profiles, running services, and last modification date">‚ùì</span>
                            </h3>
                            <p class="summary-subtitle" id="installation-summary-text">Loading installation details...</p>
                        </div>
                        <div class="summary-status" id="installation-status">
                            <div class="status-indicator checking"></div>
                            <span class="status-text">Checking...</span>
                        </div>
                    </div>
                    
                    <div class="summary-details" id="installation-details" style="display: none;">
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">Installed:</span>
                                <span class="detail-value" id="installation-date">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Last Modified:</span>
                                <span class="detail-value" id="last-modified-date">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Running Services:</span>
                                <span class="detail-value" id="running-services-count">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Version:</span>
                                <span class="detail-value" id="installation-version">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reconfiguration Options -->
                <div class="reconfiguration-options">
                    <h3 class="options-title">What would you like to do?</h3>
                    <p class="options-description">Choose from the options below to modify your installation:</p>
                    
                    <!-- Quick Action Cards Grid -->
                    <div class="reconfiguration-options-grid">
                        <!-- Add or Remove Services -->
                        <div class="reconfig-option-card" onclick="selectReconfigurationAction('add-profiles')"
                             role="button" tabindex="0" aria-label="Add or remove services option">
                            <div class="reconfig-option-icon">üì¶</div>
                            <h3>Add or Remove Services</h3>
                            <p>Install new profiles or uninstall existing services from your system</p>
                            <button class="btn-primary">Manage Services</button>
                        </div>
                        
                        <!-- Modify Service Settings -->
                        <div class="reconfig-option-card" onclick="startModifySettings()"
                             role="button" tabindex="0" aria-label="Modify service settings option">
                            <div class="reconfig-option-icon">‚öôÔ∏è</div>
                            <h3>Modify Service Settings</h3>
                            <p>Change configuration parameters for your installed services</p>
                            <button class="btn-primary">Edit Settings</button>
                        </div>
                        
                        <!-- View Dashboard -->
                        <div class="reconfig-option-card" onclick="window.location.href='/dashboard'"
                             role="button" tabindex="0" aria-label="View dashboard option">
                            <div class="reconfig-option-icon">üìä</div>
                            <h3>View Dashboard</h3>
                            <p>Monitor performance and status of your running services</p>
                            <button class="btn-secondary">Open Dashboard</button>
                        </div>
                    </div>
                    
                    <!-- Detailed Action Cards (Alternative View) -->
                    <div class="reconfiguration-actions" style="display: none;">
                        <div class="action-card" id="add-profiles-action" onclick="selectReconfigurationAction('add-profiles')" 
                             data-tooltip="Add new services to your existing installation. This will expand your Kaspa ecosystem with additional functionality like indexers, mining, or archive nodes.">
                            <div class="action-icon">‚ûï</div>
                            <div class="action-content">
                                <h4 class="action-title">Add New Profiles</h4>
                                <p class="action-description">Install additional services to expand your Kaspa ecosystem</p>
                                <div class="action-examples">
                                    <span class="example-tag">+ Indexer Services</span>
                                    <span class="example-tag">+ Mining Profile</span>
                                    <span class="example-tag">+ Archive Node</span>
                                </div>
                            </div>
                            <div class="action-arrow">‚Üí</div>
                        </div>
                        
                        <div class="action-card" id="modify-config-action" onclick="selectReconfigurationAction('modify-config')"
                             data-tooltip="Modify settings for your existing services. Change ports, network configuration, data directories, or other service parameters without reinstalling.">
                            <div class="action-icon">‚öôÔ∏è</div>
                            <div class="action-content">
                                <h4 class="action-title">Modify Configuration</h4>
                                <p class="action-description">Change settings for your existing services</p>
                                <div class="action-examples">
                                    <span class="example-tag">Port Settings</span>
                                    <span class="example-tag">Network Config</span>
                                    <span class="example-tag">Data Directories</span>
                                </div>
                            </div>
                            <div class="action-arrow">‚Üí</div>
                        </div>
                        
                        <div class="action-card" id="remove-profiles-action" onclick="selectReconfigurationAction('remove-profiles')"
                             data-tooltip="Remove services you no longer need. You can choose to keep or delete associated data. A backup will be created before removal.">
                            <div class="action-icon">üóëÔ∏è</div>
                            <div class="action-content">
                                <h4 class="action-title">Remove Profiles</h4>
                                <p class="action-description">Uninstall services you no longer need</p>
                                <div class="action-examples">
                                    <span class="example-tag">Stop Services</span>
                                    <span class="example-tag">Remove Data</span>
                                    <span class="example-tag">Clean Config</span>
                                </div>
                            </div>
                            <div class="action-arrow">‚Üí</div>
                        </div>
                    </div>
                </div>

                <!-- Profile Status Overview -->
                <div class="profile-status-overview" id="profile-status-overview" style="display: none;">
                    <h3 class="overview-title">Profile Status 
                        <span class="help-icon" data-tooltip="Current status of all available profiles. Green indicates installed and running, yellow indicates partially installed, and gray indicates not installed.">‚ùì</span>
                    </h3>
                    <div class="profile-status-grid" id="profile-status-grid">
                        <!-- Profile status cards will be populated dynamically -->
                    </div>
                </div>

                <!-- Configuration Suggestions -->
                <div class="configuration-suggestions" id="configuration-suggestions" style="display: none;">
                    <h3 class="suggestions-title">üí° Suggestions 
                        <span class="help-icon" data-tooltip="Intelligent recommendations based on your current setup and usage patterns. These suggestions can help optimize your installation.">‚ùì</span>
                    </h3>
                    <p class="suggestions-description">Based on your current setup, here are some recommendations:</p>
                    <div class="suggestions-list" id="suggestions-list">
                        <!-- Suggestions will be populated dynamically -->
                    </div>
                </div>

                <div class="step-actions">
                    <button class="btn-secondary" onclick="goToInitialMode()" 
                            data-tooltip="Start a fresh installation instead of modifying the existing one. This will clear all current settings.">
                        <span class="btn-icon">‚Üê</span>
                        Fresh Installation
                    </button>
                    <button class="btn-primary" onclick="proceedWithReconfiguration()" id="reconfigure-continue-btn" disabled
                            data-tooltip="Continue with the selected reconfiguration option. You must select an option above first.">
                        Continue
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Settings Modification Step -->
            <div id="step-settings-modification" class="wizard-step" data-step="settings-mod" style="display: none;">
                <div class="step-header">
                    <h2 class="step-title">Modify Service Settings</h2>
                    <p class="step-description">Update configuration parameters for your installed services</p>
                </div>
                
                <div class="step-content">
                    <!-- Settings modification UI will be injected here by settings-modification.js -->
                    <div id="settings-mod-container" class="settings-modification-container">
                        <!-- Content dynamically rendered -->
                    </div>
                </div>
                
                <div class="step-footer" style="display: none;">
                    <!-- Footer is managed by the settings-modification module -->
                </div>
            </div>

            <!-- Step 2: Pre-Installation Checklist -->
            <div class="wizard-step" id="step-checklist">
                <div class="step-header">
                    <h2 class="step-title">Pre-Installation Checklist</h2>
                    <p class="step-description">
                        Let's make sure you're ready to install. We'll check what you need and help you get prepared.
                    </p>
                </div>

                <!-- Checklist Progress Summary -->
                <div class="checklist-summary">
                    <div class="summary-card">
                        <div class="summary-icon">üìã</div>
                        <div class="summary-content">
                            <div class="summary-title">Checklist Progress</div>
                            <div class="summary-value"><span id="checklist-completed">0</span> of <span id="checklist-total">5</span> ready</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">‚è±Ô∏è</div>
                        <div class="summary-content">
                            <div class="summary-title">Estimated Time</div>
                            <div class="summary-value" id="estimated-time">Calculating...</div>
                        </div>
                    </div>
                </div>

                <!-- Checklist Items -->
                <div class="checklist-container">
                    
                    <!-- 1. System Requirements -->
                    <div class="checklist-item" data-item="requirements">
                        <div class="checklist-header" onclick="toggleChecklistItem('requirements')">
                            <div class="checklist-status">
                                <div class="status-icon">‚è≥</div>
                                <div class="status-text">Checking...</div>
                            </div>
                            <div class="checklist-title">
                                <h3>System Requirements</h3>
                                <p>Check if your computer has enough resources</p>
                            </div>
                            <div class="checklist-expand">‚ñº</div>
                        </div>
                        <div class="checklist-content">
                            <div class="requirement-checks" id="requirement-checks">
                                <div class="requirement-item">
                                    <div class="requirement-icon">üíª</div>
                                    <div class="requirement-info">
                                        <div class="requirement-name">CPU Cores</div>
                                        <div class="requirement-value" id="cpu-value">Checking...</div>
                                    </div>
                                    <div class="requirement-status" id="cpu-status">‚è≥</div>
                                </div>
                                <div class="requirement-item">
                                    <div class="requirement-icon">üß†</div>
                                    <div class="requirement-info">
                                        <div class="requirement-name">RAM Memory</div>
                                        <div class="requirement-value" id="ram-value">Checking...</div>
                                    </div>
                                    <div class="requirement-status" id="ram-status">‚è≥</div>
                                </div>
                                <div class="requirement-item">
                                    <div class="requirement-icon">üíæ</div>
                                    <div class="requirement-info">
                                        <div class="requirement-name">Disk Space</div>
                                        <div class="requirement-value" id="disk-value">Checking...</div>
                                    </div>
                                    <div class="requirement-status" id="disk-status">‚è≥</div>
                                </div>
                            </div>
                            <div class="checklist-help">
                                <strong>What this means:</strong> We need to make sure your computer is powerful enough to run Kaspa. Don't worry - we'll recommend the best setup for your system.
                            </div>
                        </div>
                    </div>

                    <!-- 2. Docker Installation -->
                    <div class="checklist-item" data-item="docker">
                        <div class="checklist-header" onclick="toggleChecklistItem('docker')">
                            <div class="checklist-status">
                                <div class="status-icon">‚è≥</div>
                                <div class="status-text">Checking...</div>
                            </div>
                            <div class="checklist-title">
                                <h3>Docker Installation</h3>
                                <p>Docker is required to run Kaspa services</p>
                            </div>
                            <div class="checklist-expand">‚ñº</div>
                        </div>
                        <div class="checklist-content">
                            <div class="docker-status" id="docker-status-detail">
                                <p>Checking for Docker installation...</p>
                            </div>
                            <div class="checklist-help">
                                <strong>What is Docker?</strong> Docker is like a container that packages everything Kaspa needs to run. It makes installation much easier and keeps everything organized.
                            </div>
                            <div class="checklist-actions" id="docker-actions" style="display: none;">
                                <button class="btn-secondary btn-small" onclick="showDockerGuide()">
                                    üìñ How to Install Docker
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 3. Docker Compose -->
                    <div class="checklist-item" data-item="compose">
                        <div class="checklist-header" onclick="toggleChecklistItem('compose')">
                            <div class="checklist-status">
                                <div class="status-icon">‚è≥</div>
                                <div class="status-text">Checking...</div>
                            </div>
                            <div class="checklist-title">
                                <h3>Docker Compose</h3>
                                <p>Manages multiple Docker containers together</p>
                            </div>
                            <div class="checklist-expand">‚ñº</div>
                        </div>
                        <div class="checklist-content">
                            <div class="compose-status" id="compose-status-detail">
                                <p>Checking for Docker Compose...</p>
                            </div>
                            <div class="checklist-help">
                                <strong>What is Docker Compose?</strong> This tool helps manage all the different parts of Kaspa at once. It usually comes with Docker Desktop.
                            </div>
                            <div class="checklist-actions" id="compose-actions" style="display: none;">
                                <button class="btn-secondary btn-small" onclick="showComposeGuide()">
                                    üìñ How to Install Docker Compose
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 4. Port Availability -->
                    <div class="checklist-item" data-item="ports">
                        <div class="checklist-header" onclick="toggleChecklistItem('ports')">
                            <div class="checklist-status">
                                <div class="status-icon">‚è≥</div>
                                <div class="status-text">Checking...</div>
                            </div>
                            <div class="checklist-title">
                                <h3>Network Ports</h3>
                                <p>Check if required network ports are available</p>
                            </div>
                            <div class="checklist-expand">‚ñº</div>
                        </div>
                        <div class="checklist-content">
                            <div class="ports-status" id="ports-status-detail">
                                <p>Checking port availability...</p>
                            </div>
                            <div class="checklist-help">
                                <strong>What are ports?</strong> Ports are like doors that let different programs communicate. We need certain ports to be available (not used by other programs).
                            </div>
                        </div>
                    </div>

                    <!-- 5. Help Me Choose Profile -->
                    <div class="checklist-item" data-item="quiz">
                        <div class="checklist-header" onclick="toggleChecklistItem('quiz')">
                            <div class="checklist-status">
                                <div class="status-icon">‚ùì</div>
                                <div class="status-text">Optional</div>
                            </div>
                            <div class="checklist-title">
                                <h3>Help Me Choose</h3>
                                <p>Not sure which profile to install? Take our quick quiz</p>
                            </div>
                            <div class="checklist-expand">‚ñº</div>
                        </div>
                        <div class="checklist-content">
                            <div class="quiz-container" id="quiz-container">
                                <div class="quiz-intro">
                                    <p>Answer a few quick questions and we'll recommend the best setup for you.</p>
                                    <button class="btn-primary btn-small" onclick="startQuiz()">
                                        Start Quiz
                                    </button>
                                </div>
                                <div class="quiz-questions" id="quiz-questions" style="display: none;">
                                    <!-- Quiz questions will be inserted here -->
                                </div>
                                <div class="quiz-result" id="quiz-result" style="display: none;">
                                    <!-- Quiz result will be shown here -->
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Time Estimates -->
                <div class="time-estimates" id="time-estimates" style="display: none;">
                    <h3>What to Expect</h3>
                    <div class="estimate-grid">
                        <div class="estimate-card">
                            <div class="estimate-icon">‚öôÔ∏è</div>
                            <div class="estimate-label">Setup Time</div>
                            <div class="estimate-value" id="setup-time">-</div>
                        </div>
                        <div class="estimate-card">
                            <div class="estimate-icon">‚¨áÔ∏è</div>
                            <div class="estimate-label">Download Size</div>
                            <div class="estimate-value" id="download-size">-</div>
                        </div>
                        <div class="estimate-card">
                            <div class="estimate-icon">üîÑ</div>
                            <div class="estimate-label">Sync Time</div>
                            <div class="estimate-value" id="sync-time">-</div>
                        </div>
                    </div>
                </div>

                <div class="step-actions">
                    <button class="btn-secondary" onclick="previousStep()">
                        <span class="btn-icon">‚Üê</span>
                        Back
                    </button>
                    <button class="btn-primary" onclick="nextStep()" id="checklist-continue">
                        Continue to System Check
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Step 3: System Check -->
            <div class="wizard-step" id="step-system-check">
                <div class="step-header">
                    <h2 class="step-title">System Requirements Check</h2>
                    <p class="step-description">
                        Verifying your system meets the requirements for Kaspa All-in-One
                    </p>
                </div>
                
                <div class="check-results">
                    <div class="check-item checking">
                        <div class="check-icon">
                            <div class="spinner"></div>
                        </div>
                        <div class="check-content">
                            <h3 class="check-title">Docker Installation</h3>
                            <p class="check-message">Checking for Docker...</p>
                        </div>
                        <div class="check-status">Checking</div>
                    </div>
                    
                    <div class="check-item checking">
                        <div class="check-icon">
                            <div class="spinner"></div>
                        </div>
                        <div class="check-content">
                            <h3 class="check-title">Docker Compose</h3>
                            <p class="check-message">Checking for Docker Compose...</p>
                        </div>
                        <div class="check-status">Checking</div>
                    </div>
                    
                    <div class="check-item checking">
                        <div class="check-icon">
                            <div class="spinner"></div>
                        </div>
                        <div class="check-content">
                            <h3 class="check-title">System Resources</h3>
                            <p class="check-message">Checking CPU, RAM, and disk space...</p>
                        </div>
                        <div class="check-status">Checking</div>
                    </div>
                    
                    <div class="check-item checking">
                        <div class="check-icon">
                            <div class="spinner"></div>
                        </div>
                        <div class="check-content">
                            <h3 class="check-title">Port Availability</h3>
                            <p class="check-message">Checking required ports...</p>
                        </div>
                        <div class="check-status">Checking</div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Template Selection -->
            <div class="wizard-step" id="step-templates">
                <div class="step-header">
                    <h2 class="step-title">Choose Your Setup Method</h2>
                    <p class="step-description">
                        Select a pre-configured template for quick setup, or build a custom configuration.
                    </p>
                </div>

                <!-- Setup Method Selector -->
                <div class="setup-method-selector">
                    <div class="method-card recommended" id="template-method-card">
                        <div class="method-icon">üöÄ</div>
                        <div class="method-content">
                            <h3>Use a Template</h3>
                            <p>Quick setup with pre-configured options</p>
                            <div class="method-badge">Recommended</div>
                        </div>
                    </div>
                    <div class="method-card" id="custom-method-card">
                        <div class="method-icon">‚öôÔ∏è</div>
                        <div class="method-content">
                            <h3>Build Custom</h3>
                            <p>Advanced configuration with manual selection</p>
                        </div>
                    </div>
                </div>

                <!-- Template Categories -->
                <div class="template-categories" id="template-categories">
                    <div class="category-tabs">
                        <button class="category-tab active" data-category="all">All Templates</button>
                        <button class="category-tab" data-category="beginner">Beginner</button>
                        <button class="category-tab" data-category="intermediate">Intermediate</button>
                        <button class="category-tab" data-category="advanced">Advanced</button>
                        <button class="category-tab" data-category="custom">Custom</button>
                    </div>
                </div>

                <!-- Template Grid -->
                <div class="template-grid" id="template-grid">
                    <!-- Templates will be loaded dynamically -->
                </div>

                <!-- Enhanced Custom Template Option -->
                <div class="custom-template-section" id="custom-template-section" style="display: none;">
                    <div class="custom-template-card enhanced">
                        <div class="custom-template-header">
                            <div class="custom-template-icon">‚öôÔ∏è</div>
                            <h3>Advanced: Build Custom Setup</h3>
                            <div class="custom-template-badge">For Experienced Users</div>
                        </div>
                        <div class="custom-template-content">
                            <p>Select individual services and configure them manually. This gives you complete control over your Kaspa installation.</p>
                            <div class="custom-template-features">
                                <div class="feature-item">
                                    <span class="feature-icon">üéØ</span>
                                    <span class="feature-text">Choose specific services</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-icon">‚öôÔ∏è</span>
                                    <span class="feature-text">Manual configuration</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-icon">üîß</span>
                                    <span class="feature-text">Advanced options</span>
                                </div>
                            </div>
                        </div>
                        <div class="custom-template-actions">
                            <button class="btn-secondary" id="build-custom-btn">
                                Build Custom Setup
                                <span class="btn-icon">‚Üí</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Template Details Modal -->
                <div class="modal-overlay" id="template-details-modal" style="display: none;">
                    <div class="modal-content template-details-modal">
                        <div class="modal-header">
                            <h3 id="template-modal-title">Template Details</h3>
                            <button class="modal-close" onclick="closeTemplateModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="template-details-content" id="template-details-content">
                                <!-- Template details will be loaded here -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="closeTemplateModal()">Cancel</button>
                            <button class="btn-primary" id="apply-template-btn">Use This Template</button>
                        </div>
                    </div>
                </div>
                
                <!-- Navigation buttons for template step -->
                <div class="step-actions">
                    <button class="btn-secondary" onclick="previousStep()">
                        <span class="btn-icon">‚Üê</span>
                        Back
                    </button>
                    <!-- No Continue button - templates handle their own navigation -->
                </div>
            </div>

            <!-- Step 4: Profile Selection -->
            <div class="wizard-step" id="step-profiles" data-step="5">
                <div class="step-header">
                    <h2 class="step-title" id="profile-selection-title">Select Your Deployment Profile</h2>
                    <p class="step-description" id="profile-selection-description">
                        Choose which services you want to run. You can select multiple profiles.
                    </p>
                </div>

                <!-- Reconfiguration Mode Context -->
                <div id="reconfiguration-context" class="reconfiguration-context" style="display: none;">
                    <div class="context-card">
                        <div class="context-icon" id="reconfiguration-context-icon">‚öôÔ∏è</div>
                        <div class="context-content">
                            <h3 class="context-title" id="reconfiguration-context-title">Modify Your Installation</h3>
                            <p class="context-description" id="reconfiguration-context-description">
                                You can add new profiles, modify existing ones, or remove profiles you no longer need.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Dependency Warning Container -->
                <div id="dependency-warning" class="warning-banner" style="display: none;">
                    <div class="warning-icon">‚ö†Ô∏è</div>
                    <div class="warning-content">
                        <div class="warning-title">Dependency Warning</div>
                        <div class="warning-message" id="dependency-warning-message"></div>
                    </div>
                </div>

                <!-- Resource Warning Container -->
                <div id="resource-warning" class="warning-banner" style="display: none;">
                    <div class="warning-icon">üíæ</div>
                    <div class="warning-content">
                        <div class="warning-title">Resource Warning</div>
                        <div class="warning-message" id="resource-warning-message"></div>
                    </div>
                </div>

                <!-- Combined Resource Requirements -->
                <div id="combined-resources" class="combined-resources-card" style="display: none;">
                    <h3 class="combined-resources-title">Combined Resource Requirements</h3>
                    <div class="combined-resources-grid">
                        <div class="combined-resource-item">
                            <div class="resource-icon">üíª</div>
                            <div class="resource-info">
                                <div class="resource-label">CPU Cores</div>
                                <div class="resource-value" id="combined-cpu">-</div>
                            </div>
                        </div>
                        <div class="combined-resource-item">
                            <div class="resource-icon">üß†</div>
                            <div class="resource-info">
                                <div class="resource-label">RAM Memory</div>
                                <div class="resource-value" id="combined-ram">-</div>
                            </div>
                        </div>
                        <div class="combined-resource-item">
                            <div class="resource-icon">üíæ</div>
                            <div class="resource-info">
                                <div class="resource-label">Disk Space</div>
                                <div class="resource-value" id="combined-disk">-</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Startup Order Visualization -->
                <div id="startup-order" class="startup-order-card" style="display: none;">
                    <h3 class="startup-order-title">Service Startup Order</h3>
                    <p class="startup-order-description">Services will start in this order based on dependencies:</p>
                    <div class="startup-order-timeline">
                        <div class="startup-phase" id="phase-1" style="display: none;">
                            <div class="phase-number">1</div>
                            <div class="phase-content">
                                <div class="phase-title">Kaspa Node</div>
                                <div class="phase-services" id="phase-1-services"></div>
                            </div>
                        </div>
                        <div class="startup-arrow" id="arrow-1" style="display: none;">‚Üí</div>
                        <div class="startup-phase" id="phase-2" style="display: none;">
                            <div class="phase-number">2</div>
                            <div class="phase-content">
                                <div class="phase-title">Indexer Services</div>
                                <div class="phase-services" id="phase-2-services"></div>
                            </div>
                        </div>
                        <div class="startup-arrow" id="arrow-2" style="display: none;">‚Üí</div>
                        <div class="startup-phase" id="phase-3" style="display: none;">
                            <div class="phase-number">3</div>
                            <div class="phase-content">
                                <div class="phase-title">Applications</div>
                                <div class="phase-services" id="phase-3-services"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Profile Sections Container -->
                <div id="profile-sections-container">
                    
                    <!-- Currently Installed Profiles Section (Reconfiguration Mode Only) -->
                    <div id="installed-profiles-section" class="profile-section" style="display: none;">
                        <div class="section-header">
                            <div class="section-icon">‚úÖ</div>
                            <div class="section-title-content">
                                <h3 class="section-title">Currently Installed</h3>
                                <p class="section-description">These profiles are already installed and running on your system</p>
                            </div>
                            <div class="section-status" id="installed-profiles-status">
                                <span class="status-count" id="installed-count">0</span>
                                <span class="status-label">installed</span>
                            </div>
                        </div>
                        <div class="profile-grid" id="installed-profiles-grid">
                            <!-- Installed profiles will be populated here -->
                        </div>
                    </div>

                    <!-- Available Profiles Section -->
                    <div id="available-profiles-section" class="profile-section">
                        <div class="section-header" id="available-section-header">
                            <div class="section-icon">üì¶</div>
                            <div class="section-title-content">
                                <h3 class="section-title" id="available-section-title">Available Profiles</h3>
                                <p class="section-description" id="available-section-description">Choose from these profiles to customize your Kaspa installation</p>
                            </div>
                            <div class="section-actions">
                                <button class="btn-primary btn-small" id="add-profile-btn" onclick="openProfileAdditionDialog()" style="display: none;">
                                    ‚ûï Add Profile
                                </button>
                            </div>
                            <div class="section-status" id="available-profiles-status">
                                <span class="status-count" id="available-count">5</span>
                                <span class="status-label">available</span>
                            </div>
                        </div>
                        <div class="profile-grid" id="available-profiles-grid">
                            <!-- Available profiles will be populated here -->
                        </div>
                    </div>

                    <!-- Default Profile Grid (Initial Installation Mode) -->
                    <div class="profile-grid" id="default-profile-grid">
                        <!-- Profile 1: Kaspa Node -->
                        <div class="profile-card" data-profile="kaspa-node" data-category="beginner">
                            <div class="profile-installation-status" style="display: none;">
                                <div class="installation-badge installed">
                                    <span class="badge-icon">‚úì</span>
                                    <span class="badge-text">Installed</span>
                                </div>
                                <div class="installation-info">
                                    <div class="installation-detail">
                                        <span class="detail-label">Status:</span>
                                        <span class="detail-value status-running">Running</span>
                                    </div>
                                    <div class="installation-detail">
                                        <span class="detail-label">Services:</span>
                                        <span class="detail-value">1/1</span>
                                    </div>
                                </div>
                            </div>
                            <div class="profile-icon">üñ•Ô∏è</div>
                            <div class="profile-name">Kaspa Node</div>
                            <div class="profile-description">Standard pruning Kaspa node with optional wallet</div>
                            <div class="profile-resources">
                                <div class="resource-item">
                                    <span class="resource-icon">üíæ</span>
                                    <span class="resource-value">4GB RAM</span>
                                </div>
                                <div class="resource-item">
                                    <span class="resource-icon">üíø</span>
                                    <span class="resource-value">100GB Disk</span>
                                </div>
                            </div>
                            <div class="profile-badge category-beginner">Beginner</div>
                            <div class="profile-actions" style="display: none;">
                                <div class="action-buttons">
                                    <button class="btn-action btn-modify" onclick="modifyProfile('kaspa-node')">
                                        <span class="btn-icon">‚öôÔ∏è</span>
                                        <span class="btn-text">Modify</span>
                                    </button>
                                    <button class="btn-action btn-remove" onclick="removeProfile('kaspa-node')">
                                        <span class="btn-icon">üóëÔ∏è</span>
                                        <span class="btn-text">Remove</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Profile 2: Kasia App -->
                        <div class="profile-card" data-profile="kasia-app" data-category="beginner">
                            <div class="profile-installation-status" style="display: none;">
                                <div class="installation-badge installed">
                                    <span class="badge-icon">‚úì</span>
                                    <span class="badge-text">Installed</span>
                                </div>
                                <div class="installation-info">
                                    <div class="installation-detail">
                                        <span class="detail-label">Status:</span>
                                        <span class="detail-value status-running">Running</span>
                                    </div>
                                    <div class="installation-detail">
                                        <span class="detail-label">Services:</span>
                                        <span class="detail-value">1/1</span>
                                    </div>
                                </div>
                            </div>
                            <div class="profile-icon">üí¨</div>
                            <div class="profile-name">Kasia</div>
                            <div class="profile-description">Kasia messaging and wallet application</div>
                            <div class="profile-resources">
                                <div class="resource-item">
                                    <span class="resource-icon">üíæ</span>
                                    <span class="resource-value">1GB RAM</span>
                                </div>
                                <div class="resource-item">
                                    <span class="resource-icon">üíø</span>
                                    <span class="resource-value">10GB Disk</span>
                                </div>
                            </div>
                            <div class="profile-badge category-beginner">Beginner</div>
                            <div class="profile-feature-badge public-indexer">‚úì Public Indexer</div>
                            <div class="profile-actions" style="display: none;">
                                <div class="action-buttons">
                                    <button class="btn-action btn-modify" onclick="modifyProfile('kasia-app')">
                                        <span class="btn-icon">‚öôÔ∏è</span>
                                        <span class="btn-text">Modify</span>
                                    </button>
                                    <button class="btn-action btn-remove" onclick="removeProfile('kasia-app')">
                                        <span class="btn-icon">üóëÔ∏è</span>
                                        <span class="btn-text">Remove</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Profile 3: K-Social App -->
                        <div class="profile-card" data-profile="k-social-app" data-category="beginner">
                            <div class="profile-installation-status" style="display: none;">
                                <div class="installation-badge installed">
                                    <span class="badge-icon">‚úì</span>
                                    <span class="badge-text">Installed</span>
                                </div>
                                <div class="installation-info">
                                    <div class="installation-detail">
                                        <span class="detail-label">Status:</span>
                                        <span class="detail-value status-running">Running</span>
                                    </div>
                                    <div class="installation-detail">
                                        <span class="detail-label">Services:</span>
                                        <span class="detail-value">1/1</span>
                                    </div>
                                </div>
                            </div>
                            <div class="profile-icon">üë•</div>
                            <div class="profile-name">K-Social</div>
                            <div class="profile-description">Decentralized social application</div>
                            <div class="profile-resources">
                                <div class="resource-item">
                                    <span class="resource-icon">üíæ</span>
                                    <span class="resource-value">1GB RAM</span>
                                </div>
                                <div class="resource-item">
                                    <span class="resource-icon">üíø</span>
                                    <span class="resource-value">10GB Disk</span>
                                </div>
                            </div>
                            <div class="profile-badge category-beginner">Beginner</div>
                            <div class="profile-feature-badge public-indexer">‚úì Public Indexer</div>
                            <div class="profile-actions" style="display: none;">
                                <div class="action-buttons">
                                    <button class="btn-action btn-modify" onclick="modifyProfile('k-social-app')">
                                        <span class="btn-icon">‚öôÔ∏è</span>
                                        <span class="btn-text">Modify</span>
                                    </button>
                                    <button class="btn-action btn-remove" onclick="removeProfile('k-social-app')">
                                        <span class="btn-icon">üóëÔ∏è</span>
                                        <span class="btn-text">Remove</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Profile 4: Kaspa Explorer Bundle -->
                        <div class="profile-card" data-profile="kaspa-explorer-bundle" data-category="intermediate">
                            <div class="profile-installation-status" style="display: none;">
                                <div class="installation-badge installed">
                                    <span class="badge-icon">‚úì</span>
                                    <span class="badge-text">Installed</span>
                                </div>
                                <div class="installation-info">
                                    <div class="installation-detail">
                                        <span class="detail-label">Status:</span>
                                        <span class="detail-value status-running">Running</span>
                                    </div>
                                    <div class="installation-detail">
                                        <span class="detail-label">Services:</span>
                                        <span class="detail-value">3/3</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-badge popular">Popular</div>
                            <div class="profile-icon">
                                <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                    <rect x="8" y="8" width="32" height="32" rx="4" stroke="currentColor" stroke-width="3"/>
                                    <path d="M16 24 L24 32 L32 16" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <h3 class="profile-title">Kaspa User Applications</h3>
                            <p class="profile-description">
                                User-facing apps (Kasia, K-Social, Kaspa Explorer)
                            </p>
                            <div class="profile-startup-order">
                                <span class="startup-badge">Startup Order: 3</span>
                            </div>
                            <div class="profile-services">
                                <span class="service-tag">kasia-app</span>
                                <span class="service-tag">k-social-app</span>
                                <span class="service-tag">kaspa-explorer</span>
                            </div>
                            <div class="profile-resources">
                                <div class="resource-item">
                                    <span class="resource-label">CPU:</span>
                                    <span class="resource-value">2 cores</span>
                                </div>
                                <div class="resource-item">
                                    <span class="resource-label">RAM:</span>
                                    <span class="resource-value">4 GB</span>
                                </div>
                                <div class="resource-item">
                                    <span class="resource-label">Disk:</span>
                                    <span class="resource-value">50 GB</span>
                                </div>
                            </div>
                            <div class="profile-note">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="2"/>
                                    <path d="M8 4 L8 8 L11 11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                <span>Can use public or local indexers</span>
                            </div>
                            
                            <!-- Profile Actions (Reconfiguration Mode) -->
                            <div class="profile-actions" style="display: none;">
                                <div class="action-buttons">
                                    <button class="btn-action btn-modify" onclick="modifyProfile('kaspa-user-applications')">
                                        <span class="btn-icon">‚öôÔ∏è</span>
                                        <span class="btn-text">Modify</span>
                                    </button>
                                    <button class="btn-action btn-remove" onclick="removeProfile('kaspa-user-applications')">
                                        <span class="btn-icon">üóëÔ∏è</span>
                                        <span class="btn-text">Remove</span>
                                    </button>
                                </div>
                                <div class="action-warnings" id="kaspa-user-applications-warnings" style="display: none;">
                                    <!-- Dependency warnings will be shown here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Indexer Services Profile -->
                        <div class="profile-card" data-profile="indexer-services">
                            <div class="profile-installation-status" style="display: none;">
                                <div class="installation-badge installed">
                                    <span class="badge-icon">‚úì</span>
                                    <span class="badge-text">Installed</span>
                                </div>
                                <div class="installation-info">
                                    <div class="installation-detail">
                                        <span class="detail-label">Status:</span>
                                        <span class="detail-value status-running">Running</span>
                                    </div>
                                    <div class="installation-detail">
                                        <span class="detail-label">Services:</span>
                                        <span class="detail-value">4/4</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-badge advanced">Advanced</div>
                            <div class="profile-icon">
                                <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                    <circle cx="24" cy="24" r="20" stroke="currentColor" stroke-width="3"/>
                                    <circle cx="24" cy="24" r="3" fill="currentColor"/>
                                    <line x1="24" y1="4" x2="24" y2="12" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                                    <line x1="24" y1="36" x2="24" y2="44" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                                    <line x1="4" y1="24" x2="12" y2="24" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                                    <line x1="36" y1="24" x2="44" y2="24" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                                </svg>
                            </div>
                            <h3 class="profile-title">Indexer Services</h3>
                            <p class="profile-description">
                                Local indexers (Kasia, K-Indexer, Simply-Kaspa)
                            </p>
                            <div class="profile-startup-order">
                                <span class="startup-badge">Startup Order: 2</span>
                            </div>
                            <div class="profile-services">
                                <span class="service-tag">timescaledb</span>
                                <span class="service-tag">kasia-indexer</span>
                                <span class="service-tag">k-indexer</span>
                                <span class="service-tag">simply-kaspa-indexer</span>
                            </div>
                            <div class="profile-resources">
                                <div class="resource-item">
                                    <span class="resource-label">CPU:</span>
                                    <span class="resource-value">4 cores</span>
                                </div>
                                <div class="resource-item">
                                    <span class="resource-label">RAM:</span>
                                    <span class="resource-value">8 GB</span>
                                </div>
                                <div class="resource-item">
                                    <span class="resource-label">Disk:</span>
                                    <span class="resource-value">500 GB</span>
                                </div>
                            </div>
                            <div class="profile-note">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="2"/>
                                    <path d="M8 4 L8 8 L11 11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                <span>Shared TimescaleDB with separate databases</span>
                            </div>
                            
                            <!-- Profile Actions (Reconfiguration Mode) -->
                            <div class="profile-actions" style="display: none;">
                                <div class="action-buttons">
                                    <button class="btn-action btn-modify" onclick="modifyProfile('indexer-services')">
                                        <span class="btn-icon">‚öôÔ∏è</span>
                                        <span class="btn-text">Modify</span>
                                    </button>
                                    <button class="btn-action btn-remove" onclick="removeProfile('indexer-services')">
                                        <span class="btn-icon">üóëÔ∏è</span>
                                        <span class="btn-text">Remove</span>
                                    </button>
                                </div>
                                <div class="action-warnings" id="indexer-services-warnings" style="display: none;">
                                    <!-- Dependency warnings will be shown here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Archive Node Profile -->
                        <div class="profile-card" data-profile="archive-node">
                            <div class="profile-installation-status" style="display: none;">
                                <div class="installation-badge installed">
                                    <span class="badge-icon">‚úì</span>
                                    <span class="badge-text">Installed</span>
                                </div>
                                <div class="installation-info">
                                    <div class="installation-detail">
                                        <span class="detail-label">Status:</span>
                                        <span class="detail-value status-running">Running</span>
                                    </div>
                                    <div class="installation-detail">
                                        <span class="detail-label">Services:</span>
                                        <span class="detail-value">1/1</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-badge storage">Storage</div>
                            <div class="profile-icon">
                                <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                    <rect x="8" y="12" width="32" height="8" rx="2" stroke="currentColor" stroke-width="3"/>
                                    <rect x="8" y="24" width="32" height="8" rx="2" stroke="currentColor" stroke-width="3"/>
                                    <rect x="8" y="36" width="32" height="8" rx="2" stroke="currentColor" stroke-width="3"/>
                                </svg>
                            </div>
                            <h3 class="profile-title">Archive Node Profile</h3>
                            <p class="profile-description">
                                Non-pruning Kaspa node for complete blockchain history
                            </p>
                            <div class="profile-startup-order">
                                <span class="startup-badge">Startup Order: 1</span>
                            </div>
                            <div class="profile-services">
                                <span class="service-tag">kaspa-archive-node</span>
                            </div>
                            <div class="profile-resources">
                                <div class="resource-item">
                                    <span class="resource-label">CPU:</span>
                                    <span class="resource-value">8 cores</span>
                                </div>
                                <div class="resource-item">
                                    <span class="resource-label">RAM:</span>
                                    <span class="resource-value">16 GB</span>
                                </div>
                                <div class="resource-item">
                                    <span class="resource-label">Disk:</span>
                                    <span class="resource-value">1000 GB</span>
                                </div>
                            </div>
                            <div class="profile-note warning">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M8 3 L8 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <circle cx="8" cy="12" r="1" fill="currentColor"/>
                                    <path d="M8 1 L15 14 L1 14 Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                </svg>
                                <span>Conflicts with Core Profile</span>
                            </div>
                            
                            <!-- Profile Actions (Reconfiguration Mode) -->
                            <div class="profile-actions" style="display: none;">
                                <div class="action-buttons">
                                    <button class="btn-action btn-modify" onclick="modifyProfile('archive-node')">
                                        <span class="btn-icon">‚öôÔ∏è</span>
                                        <span class="btn-text">Modify</span>
                                    </button>
                                    <button class="btn-action btn-remove" onclick="removeProfile('archive-node')">
                                        <span class="btn-icon">üóëÔ∏è</span>
                                        <span class="btn-text">Remove</span>
                                    </button>
                                </div>
                                <div class="action-warnings" id="archive-node-warnings" style="display: none;">
                                    <!-- Dependency warnings will be shown here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Mining Profile -->
                        <div class="profile-card" data-profile="mining">
                            <div class="profile-installation-status" style="display: none;">
                                <div class="installation-badge installed">
                                    <span class="badge-icon">‚úì</span>
                                    <span class="badge-text">Installed</span>
                                </div>
                                <div class="installation-info">
                                    <div class="installation-detail">
                                        <span class="detail-label">Status:</span>
                                        <span class="detail-value status-running">Running</span>
                                    </div>
                                    <div class="installation-detail">
                                        <span class="detail-label">Services:</span>
                                        <span class="detail-value">1/1</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-badge mining">Mining</div>
                            <div class="profile-icon">
                                <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                                    <path d="M24 8 L32 20 L24 24 L16 20 Z" stroke="currentColor" stroke-width="3" stroke-linejoin="round"/>
                                    <path d="M24 24 L32 20 L32 32 L24 40 Z" stroke="currentColor" stroke-width="3" stroke-linejoin="round"/>
                                    <path d="M24 24 L16 20 L16 32 L24 40 Z" stroke="currentColor" stroke-width="3" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <h3 class="profile-title">Mining Profile</h3>
                            <p class="profile-description">
                                Local mining stratum pointed to local Kaspa node
                            </p>
                            <div class="profile-startup-order">
                                <span class="startup-badge">Startup Order: 3</span>
                            </div>
                            <div class="profile-services">
                                <span class="service-tag">kaspa-stratum</span>
                            </div>
                            <div class="profile-resources">
                                <div class="resource-item">
                                    <span class="resource-label">CPU:</span>
                                    <span class="resource-value">2 cores</span>
                                </div>
                                <div class="resource-item">
                                    <span class="resource-label">RAM:</span>
                                    <span class="resource-value">2 GB</span>
                                </div>
                                <div class="resource-item">
                                    <span class="resource-label">Disk:</span>
                                    <span class="resource-value">10 GB</span>
                                </div>
                            </div>
                            <div class="profile-note prerequisite">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M8 3 L8 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <circle cx="8" cy="12" r="1" fill="currentColor"/>
                                    <path d="M8 1 L15 14 L1 14 Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                </svg>
                                <span>Requires Core or Archive Node Profile</span>
                            </div>
                            
                            <!-- Profile Actions (Reconfiguration Mode) -->
                            <div class="profile-actions" style="display: none;">
                                <div class="action-buttons">
                                    <button class="btn-action btn-modify" onclick="modifyProfile('mining')">
                                        <span class="btn-icon">‚öôÔ∏è</span>
                                        <span class="btn-text">Modify</span>
                                    </button>
                                    <button class="btn-action btn-remove" onclick="removeProfile('mining')">
                                        <span class="btn-icon">üóëÔ∏è</span>
                                        <span class="btn-text">Remove</span>
                                    </button>
                                </div>
                                <div class="action-warnings" id="mining-warnings" style="display: none;">
                                    <!-- Dependency warnings will be shown here -->
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Profile Removal Confirmation Dialog -->
                <div id="profile-removal-dialog" class="modal-overlay" style="display: none;">
                    <div class="modal-dialog">
                        <div class="modal-header">
                            <h3 class="modal-title">Remove Profile</h3>
                            <button class="modal-close" onclick="closeProfileRemovalDialog()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="removal-warning">
                                <div class="warning-icon">‚ö†Ô∏è</div>
                                <div class="warning-content">
                                    <h4 class="warning-title">Are you sure you want to remove this profile?</h4>
                                    <p class="warning-message" id="removal-warning-message">
                                        This action will stop and remove the selected services.
                                    </p>
                                </div>
                            </div>
                            
                            <div class="removal-details">
                                <h4 class="details-title">Profile Details</h4>
                                <div class="profile-summary" id="removal-profile-summary">
                                    <!-- Profile details will be populated here -->
                                </div>
                            </div>
                            
                            <div class="removal-impact" id="removal-impact" style="display: none;">
                                <h4 class="impact-title">Impact on Other Services</h4>
                                <div class="impact-warnings" id="removal-impact-warnings">
                                    <!-- Impact warnings will be populated here -->
                                </div>
                            </div>
                            
                            <div class="data-options">
                                <h4 class="options-title">Data Handling</h4>
                                <div class="data-option">
                                    <label class="radio-label">
                                        <input type="radio" name="data-handling" value="keep" checked>
                                        <span class="radio-custom"></span>
                                        <span class="radio-text">Keep data for potential reinstallation</span>
                                    </label>
                                    <p class="option-description">Service data will be preserved in Docker volumes</p>
                                </div>
                                <div class="data-option">
                                    <label class="radio-label">
                                        <input type="radio" name="data-handling" value="remove">
                                        <span class="radio-custom"></span>
                                        <span class="radio-text">Remove all data permanently</span>
                                    </label>
                                    <p class="option-description">All service data and volumes will be deleted</p>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="closeProfileRemovalDialog()">Cancel</button>
                            <button class="btn-danger" onclick="confirmProfileRemoval()" id="confirm-removal-btn">
                                Remove Profile
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Profile Addition Dialog -->
                <div id="profile-addition-dialog" class="modal-overlay" style="display: none;">
                    <div class="modal-dialog">
                        <div class="modal-header">
                            <h3 class="modal-title">Add New Profile</h3>
                            <button class="modal-close" onclick="closeProfileAdditionDialog()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <!-- Profile Selection -->
                            <div class="addition-section">
                                <h4>Select Profile to Add</h4>
                                <div id="addition-profile-selection" class="profile-selection-grid">
                                    <!-- Available profiles will be populated here -->
                                </div>
                            </div>

                            <!-- Integration Options -->
                            <div id="integration-options-section" class="addition-section" style="display: none;">
                                <h4>Integration Options</h4>
                                <div id="integration-options-content">
                                    <!-- Integration options will be populated here -->
                                </div>
                            </div>

                            <!-- Resource Impact -->
                            <div id="resource-impact-section" class="addition-section" style="display: none;">
                                <h4>Resource Impact</h4>
                                <div id="resource-impact-content" class="resource-impact-grid">
                                    <!-- Resource impact will be populated here -->
                                </div>
                            </div>

                            <!-- Service Dependencies -->
                            <div id="service-dependencies-section" class="addition-section" style="display: none;">
                                <h4>Service Dependencies</h4>
                                <div id="service-dependencies-content">
                                    <!-- Service dependencies will be populated here -->
                                </div>
                            </div>

                            <!-- Validation Messages -->
                            <div id="addition-validation-messages" class="validation-messages" style="display: none;">
                                <!-- Validation messages will be populated here -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="closeProfileAdditionDialog()">Cancel</button>
                            <button class="btn-primary" onclick="confirmProfileAddition()" id="confirm-addition-btn" disabled>
                                Add Profile
                            </button>
                        </div>
                    </div>
                </div>
                
            </div>

            <!-- Step 4: Configure -->
            <div class="wizard-step" id="step-configure">
                <div class="step-header">
                    <h2 class="step-title">Configure Your Services</h2>
                    <p class="step-description">
                        Customize settings for your selected services
                    </p>
                </div>
                
                <div class="config-sections">
                    <div class="config-section">
                        <h3 class="config-section-title">Network Configuration</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label for="external-ip" class="form-label">
                                    External IP Address
                                    <span class="form-tooltip" title="Your public IP address for P2P connections">‚ìò</span>
                                </label>
                                <input type="text" id="external-ip" class="form-input" placeholder="Auto-detect" />
                                <button class="btn-secondary btn-small" onclick="detectExternalIP()">Auto-Detect</button>
                            </div>
                            
                            <div class="form-group">
                                <label for="public-node" class="form-label">
                                    Public Node
                                    <span class="form-tooltip" title="Allow external connections to your node">‚ìò</span>
                                </label>
                                <div class="form-toggle">
                                    <input type="checkbox" id="public-node" class="toggle-input" />
                                    <label for="public-node" class="toggle-label">
                                        <span class="toggle-switch"></span>
                                        <span class="toggle-text">Enable public access</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Indexer Endpoints (Kaspa User Applications profile only) -->
                    <div class="config-section" id="indexer-endpoints-section" style="display: none;">
                        <h3 class="config-section-title">Indexer Endpoints</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label for="kasia-indexer-url" class="form-label">
                                    Kasia Indexer URL
                                    <span class="form-tooltip" title="URL for Kasia indexer API (use local indexer URL if indexer-services profile is selected)">‚ìò</span>
                                </label>
                                <input type="text" id="kasia-indexer-url" class="form-input" placeholder="https://api.kasia.io/" value="https://api.kasia.io/" />
                            </div>
                            
                            <div class="form-group">
                                <label for="ksocial-indexer-url" class="form-label">
                                    K-Social Indexer URL
                                    <span class="form-tooltip" title="URL for K-Social indexer API (use local indexer URL if indexer-services profile is selected)">‚ìò</span>
                                </label>
                                <input type="text" id="ksocial-indexer-url" class="form-input" placeholder="https://indexer0.kaspatalk.net/" value="https://indexer0.kaspatalk.net/" />
                            </div>
                            
                            <div class="form-group">
                                <label for="kaspa-node-ws-url" class="form-label">
                                    Kaspa Node WebSocket URL
                                    <span class="form-tooltip" title="WebSocket URL for Kaspa node connection (use local node URL if core profile is selected)">‚ìò</span>
                                </label>
                                <input type="text" id="kaspa-node-ws-url" class="form-input" placeholder="wss://api.kasia.io/ws" value="wss://api.kasia.io/ws" />
                            </div>
                        </div>
                    </div>
                    
                    <!-- Kaspa Node Configuration (Core/Archive profiles only) -->
                    <div class="config-section" id="kaspa-node-config-section" style="display: none;">
                        <h3 class="config-section-title">Kaspa Node Configuration</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label for="kaspa-network" class="form-label">
                                    Network
                                    <span class="form-tooltip" title="Select mainnet or testnet. Changing networks requires fresh installation.">‚ìò</span>
                                </label>
                                <select id="kaspa-network" class="form-select">
                                    <option value="mainnet" selected>Mainnet</option>
                                    <option value="testnet">Testnet</option>
                                </select>
                                <p class="form-help-text">Current network: <span id="current-network-display">mainnet</span></p>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    Port Configuration
                                    <span class="form-tooltip" title="Configure RPC and P2P ports for the Kaspa node">‚ìò</span>
                                </label>
                                <div class="port-config-display">
                                    <div class="port-display-item">
                                        <span class="port-label">RPC Port:</span>
                                        <span class="port-value" id="rpc-port-display">16110</span>
                                    </div>
                                    <div class="port-display-item">
                                        <span class="port-label">P2P Port:</span>
                                        <span class="port-value" id="p2p-port-display">16111</span>
                                    </div>
                                </div>
                                <button class="btn-secondary btn-small" onclick="openPortConfigModal()">
                                    Configure Ports
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Wallet Configuration Section -->
                    <div id="wallet-configuration-section" class="config-section hidden">
                        <h3 class="config-section-title">
                            <span class="section-icon">üîê</span>
                            Wallet & Mining Configuration
                        </h3>
                        <div class="config-form">
                            <!-- Wallet Connectivity Toggle -->
                            <div class="form-group">
                                <div class="form-toggle">
                                    <input type="checkbox" id="wallet-connectivity-toggle" class="toggle-input"
                                           data-field-key="WALLET_CONNECTIVITY_ENABLED" />
                                    <label for="wallet-connectivity-toggle" class="toggle-label">
                                        <span class="toggle-switch"></span>
                                        <span class="toggle-text">Enable Wallet Connectivity</span>
                                    </label>
                                </div>
                                <div class="form-help">
                                    Enables UTXO indexing and WebSocket RPC endpoints for wallet connections. Required for receiving mining rewards or connecting external wallets.
                                </div>
                            </div>
                            
                            <!-- Wallet Setup Panel Container (rendered by wallet-setup.js) -->
                            <div id="wallet-setup-container" class="hidden">
                                <!-- WalletSetupPanel will be rendered here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-section" id="mining-config-section" style="display: none;">
                        <h3 class="config-section-title">Mining Configuration</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label for="mining-address" class="form-label">
                                    Mining Address
                                    <span class="required-badge">Required</span>
                                    <span class="form-tooltip" title="Kaspa address to receive mining rewards. Must be a valid kaspa: address.">‚ìò</span>
                                </label>
                                <input type="text" id="mining-address" class="form-input" placeholder="kaspa:qr..." required />
                                <div class="form-help">
                                    Your Kaspa wallet address where mining rewards will be sent.
                                </div>
                            </div>

                            <div id="stratum-config-group">
                                <div class="form-group">
                                    <label for="stratum-port" class="form-label">
                                        Stratum Port
                                        <span class="form-tooltip" title="Port for the stratum bridge that miners connect to">‚ìò</span>
                                    </label>
                                    <input type="number" id="stratum-port" class="form-input" value="5555" min="1024" max="65535" />
                                    <div class="form-help">
                                        Port number for the mining stratum bridge (default: 5555).
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="min-share-diff" class="form-label">
                                        Minimum Share Difficulty
                                        <span class="form-tooltip" title="Minimum difficulty for mining shares">‚ìò</span>
                                    </label>
                                    <input type="number" id="min-share-diff" class="form-input" value="4" min="1" />
                                    <div class="form-help">
                                        Minimum difficulty level for accepted mining shares (default: 4).
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label toggle-label">
                                        <span>Variable Difficulty</span>
                                        <span class="form-tooltip" title="Automatically adjust mining difficulty per worker">‚ìò</span>
                                        <div class="toggle-switch">
                                            <input type="checkbox" id="var-diff" checked />
                                            <span class="toggle-slider"></span>
                                        </div>
                                    </label>
                                    <div class="form-help">
                                        Automatically adjusts difficulty for each miner based on their hashrate.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h3 class="config-section-title">Database Configuration</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label for="k-social-db-password" class="form-label">
                                    K-Social Database Password
                                    <span class="form-tooltip" title="Password for K-Social TimescaleDB database">‚ìò</span>
                                </label>
                                <div class="password-input-group">
                                    <input type="password" id="k-social-db-password" class="form-input" placeholder="Auto-generated" />
                                    <button class="btn-icon-only" onclick="togglePasswordVisibility('k-social-db-password')">
                                        <span class="icon-eye">üëÅ</span>
                                    </button>
                                    <button class="btn-secondary btn-small" onclick="generatePassword('k-social-db-password')">Generate</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="simply-kaspa-db-password" class="form-label">
                                    Simply Kaspa Database Password
                                    <span class="form-tooltip" title="Password for Simply Kaspa TimescaleDB database">‚ìò</span>
                                </label>
                                <div class="password-input-group">
                                    <input type="password" id="simply-kaspa-db-password" class="form-input" placeholder="Auto-generated" />
                                    <button class="btn-icon-only" onclick="togglePasswordVisibility('simply-kaspa-db-password')">
                                        <span class="icon-eye">üëÅ</span>
                                    </button>
                                    <button class="btn-secondary btn-small" onclick="generatePassword('simply-kaspa-db-password')">Generate</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-section">
                        <h3 class="config-section-title">Advanced Options</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="advanced-mode" />
                                    Show advanced configuration options
                                </label>
                            </div>
                            
                            <div id="advanced-options" class="advanced-options" style="display: none;">
                                <!-- Data Directory Configuration (profile-specific) -->
                                <div id="kaspa-data-dir-group" class="form-group" style="display: none;">
                                    <label for="kaspa-data-dir" class="form-label">
                                        Kaspa Node Data Directory
                                        <span class="form-tooltip" title="Container path for Kaspa node data (Docker volume)">‚ìò</span>
                                    </label>
                                    <input type="text" id="kaspa-data-dir" class="form-input" 
                                           placeholder="/data/kaspa" value="/data/kaspa" />
                                    <p class="form-help-text">Default: /data/kaspa</p>
                                </div>
                                
                                <div id="kaspa-archive-data-dir-group" class="form-group" style="display: none;">
                                    <label for="kaspa-archive-data-dir" class="form-label">
                                        Archive Node Data Directory
                                        <span class="form-tooltip" title="Container path for archive node data (requires significant disk space)">‚ìò</span>
                                    </label>
                                    <input type="text" id="kaspa-archive-data-dir" class="form-input" 
                                           placeholder="/data/kaspa-archive" value="/data/kaspa-archive" />
                                    <p class="form-help-text">Default: /data/kaspa-archive (requires significant disk space)</p>
                                </div>
                                
                                <div id="timescaledb-data-dir-group" class="form-group" style="display: none;">
                                    <label for="timescaledb-data-dir" class="form-label">
                                        TimescaleDB Data Directory
                                        <span class="form-tooltip" title="Container path for TimescaleDB data">‚ìò</span>
                                    </label>
                                    <input type="text" id="timescaledb-data-dir" class="form-input" 
                                           placeholder="/data/timescaledb" value="/data/timescaledb" />
                                    <p class="form-help-text">Default: /data/timescaledb</p>
                                </div>
                                
                                <div class="form-group">
                                    <label for="custom-env" class="form-label">
                                        Custom Environment Variables
                                        <span class="form-tooltip" title="Additional environment variables in KEY=value format">‚ìò</span>
                                    </label>
                                    <textarea id="custom-env" class="form-textarea" rows="6" placeholder="KEY=value&#10;ANOTHER_KEY=another_value"></textarea>
                                    <p class="form-help-text">One variable per line in KEY=value format</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="step-actions">
                    <button class="btn-secondary" onclick="previousStep()">
                        <span class="btn-icon">‚Üê</span>
                        Back
                    </button>
                    <button class="btn-primary" onclick="nextStep()">
                        Continue
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Step 5: Review -->
            <div class="wizard-step" id="step-review">
                <div class="step-header">
                    <h2 class="step-title">Review Your Configuration</h2>
                    <p class="step-description">
                        Verify your selections before installation
                    </p>
                </div>
                
                <div class="review-sections">
                    <div class="review-section">
                        <h3 class="review-section-title">Selected Profiles</h3>
                        <div class="review-content">
                            <div class="review-item">
                                <span class="review-label">Profiles:</span>
                                <span class="review-value" id="review-profiles"></span>
                            </div>
                            <div class="review-item">
                                <span class="review-label">Total Services:</span>
                                <span class="review-value" id="review-service-count"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="review-section">
                        <h3 class="review-section-title">Resource Requirements</h3>
                        <div class="review-content">
                            <div class="review-item">
                                <span class="review-label">CPU:</span>
                                <span class="review-value" id="review-cpu"></span>
                            </div>
                            <div class="review-item">
                                <span class="review-label">RAM:</span>
                                <span class="review-value" id="review-ram"></span>
                            </div>
                            <div class="review-item">
                                <span class="review-label">Disk:</span>
                                <span class="review-value" id="review-disk"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="review-section">
                        <h3 class="review-section-title">Network Configuration</h3>
                        <div class="review-content">
                            <div class="review-item">
                                <span class="review-label">External IP:</span>
                                <span class="review-value" id="review-external-ip"></span>
                            </div>
                            <div class="review-item">
                                <span class="review-label">Public Node:</span>
                                <span class="review-value" id="review-public-node"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="review-section warning">
                        <div class="review-warning-icon">‚ö†Ô∏è</div>
                        <div class="review-warning-content">
                            <h4 class="review-warning-title">Before You Continue</h4>
                            <ul class="review-warning-list">
                                <li>Ensure you have sufficient disk space available</li>
                                <li>Initial blockchain sync may take several hours</li>
                                <li>Services will be accessible on localhost by default</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="step-actions">
                    <button class="btn-secondary" onclick="previousStep()">
                        <span class="btn-icon">‚Üê</span>
                        Back
                    </button>
                    <button class="btn-primary" onclick="nextStep()">
                        Start Installation
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Step 6: Install -->
            <div class="wizard-step" id="step-install">
                <div class="step-header">
                    <h2 class="step-title">Installing Kaspa All-in-One</h2>
                    <p class="step-description">
                        Please wait while we set up your services
                    </p>
                </div>
                
                <div class="install-progress">
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-bar-fill" id="install-progress-bar" style="width: 0%"></div>
                        </div>
                        <div class="progress-percentage" id="install-progress-percentage">0%</div>
                    </div>
                    
                    <div class="install-status">
                        <div class="status-icon">
                            <div class="spinner"></div>
                        </div>
                        <div class="status-content">
                            <h3 class="status-title" id="install-status-title">Initializing...</h3>
                            <p class="status-message" id="install-status-message">Preparing installation environment</p>
                        </div>
                    </div>
                    
                    <div class="install-steps">
                        <div class="install-step" data-step="env">
                            <div class="install-step-icon">‚è≥</div>
                            <div class="install-step-content">
                                <h4 class="install-step-title">Creating environment configuration</h4>
                                <p class="install-step-status">Pending</p>
                            </div>
                        </div>
                        
                        <div class="install-step" data-step="pull">
                            <div class="install-step-icon">‚è≥</div>
                            <div class="install-step-content">
                                <h4 class="install-step-title">Pulling Docker images</h4>
                                <p class="install-step-status">Pending</p>
                            </div>
                        </div>
                        
                        <div class="install-step" data-step="start">
                            <div class="install-step-icon">‚è≥</div>
                            <div class="install-step-content">
                                <h4 class="install-step-title">Starting services</h4>
                                <p class="install-step-status">Pending</p>
                            </div>
                        </div>
                        
                        <div class="install-step" data-step="health">
                            <div class="install-step-icon">‚è≥</div>
                            <div class="install-step-content">
                                <h4 class="install-step-title">Running health checks</h4>
                                <p class="install-step-status">Pending</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="install-logs">
                        <div class="logs-header">
                            <h4 class="logs-title">Installation Logs</h4>
                            <button class="btn-secondary btn-small" onclick="toggleLogs()">
                                <span id="logs-toggle-text">Show Details</span>
                            </button>
                        </div>
                        <div class="logs-content" id="install-logs-content" style="display: none;">
                            <pre class="logs-text" id="install-logs-text">Waiting for installation to start...</pre>
                        </div>
                    </div>
                </div>
                
                <div class="step-actions">
                    <button class="btn-secondary" onclick="cancelInstallation()" id="cancel-install-btn">
                        Cancel Installation
                    </button>
                    <button class="btn-primary" onclick="nextStep()" id="install-continue-btn" disabled>
                        Continue
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Step 8: Complete -->
            <div class="wizard-step" id="step-complete">
                <div class="step-header">
                    <div class="completion-icon celebration">
                        <svg width="80" height="80" viewBox="0 0 80 80" fill="none" class="checkmark-svg">
                            <circle cx="40" cy="40" r="38" stroke="#7ED321" stroke-width="4" class="checkmark-circle"/>
                            <path d="M25 40 L35 50 L55 30" stroke="#7ED321" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" class="checkmark-path"/>
                        </svg>
                        <!-- Celebration confetti -->
                        <div class="confetti-container">
                            <div class="confetti"></div>
                            <div class="confetti"></div>
                            <div class="confetti"></div>
                            <div class="confetti"></div>
                            <div class="confetti"></div>
                            <div class="confetti"></div>
                        </div>
                    </div>
                    <h2 class="step-title">üéâ Installation Complete!</h2>
                    <p class="step-description">
                        Your Kaspa All-in-One system is up and running. Let's make sure everything is working perfectly!
                    </p>
                </div>
                
                <!-- Tour Prompt -->
                <div class="tour-prompt">
                    <div class="tour-prompt-content">
                        <div class="tour-prompt-icon">üéØ</div>
                        <div class="tour-prompt-text">
                            <h3>Want a quick tour?</h3>
                            <p>We'll show you around and help you verify everything is working</p>
                        </div>
                    </div>
                    <div class="tour-prompt-actions">
                        <button class="btn-secondary" onclick="skipTour()">Skip for now</button>
                        <button class="btn-primary" onclick="startTour()">
                            Start Tour
                            <span class="btn-icon">‚Üí</span>
                        </button>
                    </div>
                </div>
                
                <div class="completion-sections">
                    <!-- Service Verification Section -->
                    <div class="completion-section" id="service-verification">
                        <div class="section-header">
                            <h3 class="completion-section-title">‚úì Service Verification</h3>
                            <button class="btn-text" onclick="runServiceVerification()">
                                <span class="btn-icon">üîÑ</span> Check Again
                            </button>
                        </div>
                        <p class="section-description">Let's verify all your services are healthy and running correctly</p>
                        
                        <div class="verification-status" id="verification-status">
                            <div class="verification-progress">
                                <div class="spinner-small"></div>
                                <span>Checking services...</span>
                            </div>
                        </div>
                        
                        <div class="service-status-list" id="service-status-list" style="display: none;">
                            <!-- Services will be populated dynamically -->
                        </div>
                        
                        <div class="verification-summary" id="verification-summary" style="display: none;">
                            <div class="summary-badge success">
                                <span class="badge-icon">‚úì</span>
                                <span class="badge-text">All services healthy</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Getting Started Guide -->
                    <div class="completion-section" id="getting-started">
                        <h3 class="completion-section-title">üöÄ What Now? Getting Started</h3>
                        <p class="section-description">Here's what you can do with your new Kaspa system</p>
                        
                        <div class="getting-started-grid">
                            <div class="guide-card" data-tour-target="dashboard">
                                <div class="guide-card-header">
                                    <div class="guide-card-icon">üìä</div>
                                    <h4 class="guide-card-title">Monitor Your System</h4>
                                </div>
                                <p class="guide-card-description">
                                    Use the dashboard to check service health, view logs, and monitor your node's sync progress
                                </p>
                                <div class="guide-card-actions">
                                    <button class="btn-link" onclick="openDashboard()">Open Dashboard ‚Üí</button>
                                    <button class="btn-text" onclick="startDashboardTour()">Take a tour</button>
                                </div>
                            </div>
                            
                            <div class="guide-card">
                                <div class="guide-card-header">
                                    <div class="guide-card-icon">‚è±Ô∏è</div>
                                    <h4 class="guide-card-title">Wait for Sync</h4>
                                </div>
                                <p class="guide-card-description">
                                    Your Kaspa node is syncing with the network. This typically takes 2-6 hours depending on your connection
                                </p>
                                <div class="guide-card-tip">
                                    <strong>Tip:</strong> You can monitor sync progress in the dashboard. The node is ready when it shows "Synced"
                                </div>
                            </div>
                            
                            <div class="guide-card">
                                <div class="guide-card-header">
                                    <div class="guide-card-icon">üîß</div>
                                    <h4 class="guide-card-title">Manage Services</h4>
                                </div>
                                <p class="guide-card-description">
                                    Start, stop, or restart services as needed. Each service can be controlled independently
                                </p>
                                <div class="guide-card-actions">
                                    <button class="btn-text" onclick="showServiceManagementGuide()">Learn how ‚Üí</button>
                                </div>
                            </div>
                            
                            <div class="guide-card">
                                <div class="guide-card-header">
                                    <div class="guide-card-icon">üìö</div>
                                    <h4 class="guide-card-title">Learn More</h4>
                                </div>
                                <p class="guide-card-description">
                                    Explore documentation, watch video tutorials, and join the community
                                </p>
                                <div class="guide-card-actions">
                                    <button class="btn-text" onclick="showResourcesModal()">View resources ‚Üí</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="completion-section">
                        <h3 class="completion-section-title">‚ö° Quick Actions</h3>
                        <div class="quick-actions-grid">
                            <button class="action-card" onclick="openDashboard()">
                                <div class="action-card-icon">üìä</div>
                                <div class="action-card-content">
                                    <h4 class="action-card-title">Open Dashboard</h4>
                                    <p class="action-card-description">Monitor and control services</p>
                                </div>
                                <span class="action-card-arrow">‚Üí</span>
                            </button>
                            
                            <button class="action-card" onclick="checkSyncStatus()">
                                <div class="action-card-icon">üîÑ</div>
                                <div class="action-card-content">
                                    <h4 class="action-card-title">Check Sync Status</h4>
                                    <p class="action-card-description">See blockchain sync progress</p>
                                </div>
                                <span class="action-card-arrow">‚Üí</span>
                            </button>
                            
                            <button class="action-card" onclick="viewLogs()">
                                <div class="action-card-icon">üìù</div>
                                <div class="action-card-content">
                                    <h4 class="action-card-title">View Logs</h4>
                                    <p class="action-card-description">Check service logs</p>
                                </div>
                                <span class="action-card-arrow">‚Üí</span>
                            </button>
                            
                            <button class="action-card" onclick="showResourcesModal()">
                                <div class="action-card-icon">üìö</div>
                                <div class="action-card-content">
                                    <h4 class="action-card-title">Documentation</h4>
                                    <p class="action-card-description">Learn more about Kaspa</p>
                                </div>
                                <span class="action-card-arrow">‚Üí</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Help & Support -->
                    <div class="completion-section">
                        <h3 class="completion-section-title">üí¨ Need Help?</h3>
                        <div class="help-options">
                            <a href="https://discord.com/invite/ssB46MXzRU" target="_blank" class="help-option">
                                <div class="help-option-icon">üí¨</div>
                                <div class="help-option-content">
                                    <h4>Join Discord</h4>
                                    <p>Get help from the community</p>
                                </div>
                            </a>
                            <a href="https://kaspa.org/docs" target="_blank" class="help-option">
                                <div class="help-option-icon">üìñ</div>
                                <div class="help-option-content">
                                    <h4>Read Docs</h4>
                                    <p>Comprehensive guides and tutorials</p>
                                </div>
                            </a>
                            <a href="https://github.com/kaspanet" target="_blank" class="help-option">
                                <div class="help-option-icon">üêõ</div>
                                <div class="help-option-content">
                                    <h4>Report Issue</h4>
                                    <p>Found a bug? Let us know</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Dashboard Navigation Section -->
                <div class="completion-section dashboard-navigation">
                    <h3 class="completion-section-title">üìä Next Steps: Access Your Dashboard</h3>
                    <p class="section-description">
                        Your installation is complete! Access the Management Dashboard to monitor and control your Kaspa services.
                    </p>
                    
                    <div class="dashboard-access-options">
                        <div class="dashboard-option primary-option">
                            <div class="option-header">
                                <div class="option-icon">üöÄ</div>
                                <div class="option-content">
                                    <h4 class="option-title">Go to Dashboard</h4>
                                    <p class="option-description">Open the Management Dashboard in this browser</p>
                                </div>
                            </div>
                            <div class="option-actions">
                                <a href="http://localhost:8080" target="_blank" class="btn-primary btn-large dashboard-link">
                                    Open Dashboard
                                    <span class="btn-icon">‚Üí</span>
                                </a>
                            </div>
                        </div>
                        
                        <div class="dashboard-option secondary-option">
                            <div class="option-header">
                                <div class="option-icon">üîó</div>
                                <div class="option-content">
                                    <h4 class="option-title">Manual Access</h4>
                                    <p class="option-description">Copy the URL to access from any browser</p>
                                </div>
                            </div>
                            <div class="option-actions">
                                <div class="url-display">
                                    <input type="text" value="http://localhost:8080" readonly class="dashboard-url-input" id="dashboard-url">
                                    <button class="btn-secondary btn-small" onclick="copyDashboardUrl()">
                                        <span class="btn-icon">üìã</span> Copy
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-info">
                        <div class="info-item">
                            <span class="info-icon">üí°</span>
                            <span class="info-text">
                                <strong>Tip:</strong> Bookmark the dashboard URL for easy access. The dashboard runs on your local machine at port 8080.
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-icon">üîÑ</span>
                            <span class="info-text">
                                If the dashboard doesn't load, it may still be starting up. Wait a moment and try again.
                            </span>
                        </div>
                    </div>
                </div>

                <div class="step-actions">
                    <button class="btn-secondary" onclick="restartWizard()">
                        <span class="btn-icon">‚Ü∫</span> Run Wizard Again
                    </button>
                    <button class="btn-primary btn-large" onclick="handleCompletionNavigation()">
                        <span id="completion-nav-text">Go to Dashboard</span>
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>
            
        </main>

        <!-- Navigation Footer - Fixed at bottom -->
        <div class="wizard-navigation-footer" id="wizard-navigation-footer">
            <!-- Developer Mode Section -->
            <div class="developer-mode-section" id="global-developer-mode-section" style="display: none;">
                <div class="developer-mode-card">
                    <div class="developer-mode-header">
                        <div class="developer-mode-icon">
                            <svg width="32" height="32" viewBox="0 0 48 48" fill="none">
                                <path d="M16 16 L8 24 L16 32" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M32 16 L40 24 L32 32" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                                <line x1="28" y1="12" x2="20" y2="36" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <div class="developer-mode-title-section">
                            <h3 class="developer-mode-title">Developer Mode</h3>
                            <p class="developer-mode-subtitle">Add development tools to your selected profiles</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="developer-mode-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="developer-mode-content" id="developer-mode-details" style="display: none;">
                        <p class="developer-mode-description">
                            Developer Mode adds inspection tools and debugging features to your installation:
                        </p>
                        <ul class="developer-mode-features">
                            <li>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M7 10 L9 12 L13 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <span><strong>Debug Logging:</strong> Verbose logs for troubleshooting (LOG_LEVEL=debug)</span>
                            </li>
                            <li>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M7 10 L9 12 L13 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <span><strong>Portainer:</strong> Docker container management UI (port 9000)</span>
                            </li>
                            <li>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M7 10 L9 12 L13 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <span><strong>pgAdmin:</strong> PostgreSQL database management (port 5050)</span>
                            </li>
                            <li>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M7 10 L9 12 L13 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <span><strong>Exposed Ports:</strong> Additional service ports for direct access</span>
                            </li>
                            <li>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M7 10 L9 12 L13 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <span><strong>Log Access:</strong> Direct access to service logs</span>
                            </li>
                        </ul>
                        <div class="developer-mode-warning">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M10 6 L10 11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                <circle cx="10" cy="14" r="1" fill="currentColor"/>
                                <path d="M10 2 L18 16 L2 16 Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                            </svg>
                            <span>Developer Mode increases resource usage and exposes additional ports. Only enable for development environments.</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step Actions Container -->
            <div class="step-actions" id="global-step-actions">
                <!-- Navigation buttons will be dynamically inserted here -->
            </div>
        </div>

        </div><!-- /.wizard-main -->
        </div><!-- /.wizard-layout -->

        <!-- Footer -->
        <footer class="wizard-footer">
            <div class="footer-content">
                <div class="footer-logo">
                    <picture>
                        <source srcset="/assets/brand/icons/svg/kaspa-icon-dark.svg" 
                                media="(prefers-color-scheme: dark)">
                        <img src="/assets/brand/icons/svg/kaspa-icon-light.svg" 
                             alt="Kaspa" 
                             class="footer-logo-img">
                    </picture>
                    <span class="footer-text">Kaspa All-in-One</span>
                </div>
                <div class="footer-actions">
                    <button class="btn-footer btn-report-bug" onclick="window.open('https://github.com/kaspa-kcoin/kaspa-all-in-one/issues/new?template=bug_report.md', '_blank')">
                        üêõ Report Bug
                    </button>
                    <button class="btn-footer btn-suggest-feature" onclick="window.open('https://github.com/kaspa-kcoin/kaspa-all-in-one/issues/new?template=feature_request.md', '_blank')">
                        üí° Suggest Feature
                    </button>
                    <button class="btn-footer btn-known-issues" onclick="window.open('/KNOWN_ISSUES.md', '_blank')">
                        üìã View Known Issues
                    </button>
                    <button class="btn-footer btn-donate" onclick="window.open('https://kas.coffee/jtmac58', '_blank')">
                        ‚òï Buy me a Koffee
                    </button>
                </div>
                <div class="footer-links">
                    <a href="https://kaspa.org" target="_blank">kaspa.org</a>
                    <a href="https://github.com/kaspanet" target="_blank">GitHub</a>
                    <a href="https://discord.com/invite/ssB46MXzRU" target="_blank">Discord</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Safety Confirmation Modal -->
    <div id="safety-confirmation-modal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="safety.handleConfirmationAction('cancel')"></div>
        <div class="modal-content safety-confirmation-content">
            <div class="modal-header">
                <h2>Confirmation Required</h2>
                <button class="modal-close" onclick="safety.handleConfirmationAction('cancel')">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Safety confirmation content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Installation Guide Modal -->
    <div id="installation-guide-modal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeInstallationGuide()"></div>
        <div class="modal-content installation-guide-content">
            <div class="modal-header">
                <h2 id="guide-title">Installation Guide</h2>
                <button class="modal-close" onclick="closeInstallationGuide()">√ó</button>
            </div>
            <div class="modal-body" id="guide-body">
                <!-- Guide content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Error Remediation Modal -->
    <div id="error-remediation-modal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="errorRemediation.closeRemediationModal()"></div>
        <div class="modal-content remediation-content">
            <div class="modal-header">
                <h2 id="remediation-title">Error - Auto-Fix Available</h2>
                <button class="modal-close" onclick="errorRemediation.closeRemediationModal()">√ó</button>
            </div>
            <div class="modal-body" id="remediation-body">
                <!-- Remediation content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Interactive Tour Modal -->
    <div id="tour-modal" class="modal tour-modal" style="display: none;">
        <div class="modal-overlay" onclick="closeTour()"></div>
        <div class="modal-content tour-content">
            <div class="modal-header">
                <div class="tour-progress">
                    <span class="tour-step-indicator">Step <span id="tour-current-step">1</span> of <span id="tour-total-steps">5</span></span>
                </div>
                <button class="modal-close" onclick="closeTour()">√ó</button>
            </div>
            <div class="modal-body tour-body" id="tour-body">
                <!-- Tour content will be inserted here -->
            </div>
            <div class="modal-footer tour-footer">
                <button class="btn-text" onclick="skipTour()">Skip Tour</button>
                <div class="tour-navigation">
                    <button class="btn-secondary" id="tour-prev-btn" onclick="previousTourStep()" disabled>
                        <span class="btn-icon">‚Üê</span> Previous
                    </button>
                    <button class="btn-primary" id="tour-next-btn" onclick="nextTourStep()">
                        Next <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Resources Modal -->
    <div id="resources-modal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeResourcesModal()"></div>
        <div class="modal-content resources-content">
            <div class="modal-header">
                <h2>üìö Resources & Documentation</h2>
                <button class="modal-close" onclick="closeResourcesModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="resources-grid">
                    <div class="resource-category">
                        <h3 class="resource-category-title">üìñ Documentation</h3>
                        <div class="resource-links">
                            <a href="https://kaspa.org/docs" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üìÑ</span>
                                <span class="resource-link-text">Official Documentation</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="https://github.com/kaspanet" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üíª</span>
                                <span class="resource-link-text">GitHub Repository</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="./docs/README.md" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üìã</span>
                                <span class="resource-link-text">Local Documentation</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                        </div>
                    </div>
                    
                    <div class="resource-category">
                        <h3 class="resource-category-title">üé• Video Tutorials</h3>
                        <div class="resource-links">
                            <a href="https://youtube.com/@kaspa" target="_blank" class="resource-link">
                                <span class="resource-link-icon">‚ñ∂Ô∏è</span>
                                <span class="resource-link-text">Getting Started Video</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="https://youtube.com/@kaspa" target="_blank" class="resource-link">
                                <span class="resource-link-icon">‚ñ∂Ô∏è</span>
                                <span class="resource-link-text">Dashboard Overview</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="https://youtube.com/@kaspa" target="_blank" class="resource-link">
                                <span class="resource-link-icon">‚ñ∂Ô∏è</span>
                                <span class="resource-link-text">Troubleshooting Guide</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                        </div>
                    </div>
                    
                    <div class="resource-category">
                        <h3 class="resource-category-title">üí¨ Community</h3>
                        <div class="resource-links">
                            <a href="https://discord.com/invite/ssB46MXzRU" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üí¨</span>
                                <span class="resource-link-text">Discord Community</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="https://reddit.com/r/kaspa" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üó®Ô∏è</span>
                                <span class="resource-link-text">Reddit Community</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="https://t.me/kaspaenglish" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üì±</span>
                                <span class="resource-link-text">Telegram Group</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                        </div>
                    </div>
                    
                    <div class="resource-category">
                        <h3 class="resource-category-title">üîß Tools & Utilities</h3>
                        <div class="resource-links">
                            <a href="http://localhost:3000" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üìä</span>
                                <span class="resource-link-text">Management Dashboard</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="https://explorer.kaspa.org" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üîç</span>
                                <span class="resource-link-text">Block Explorer</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                            <a href="https://kaspa.org/tools" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üõ†Ô∏è</span>
                                <span class="resource-link-text">More Tools</span>
                                <span class="resource-link-arrow">‚Üí</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tour Spotlight Overlay -->
    <div id="tour-spotlight" class="tour-spotlight" style="display: none;">
        <div class="spotlight-overlay"></div>
        <div class="spotlight-target"></div>
        <div class="spotlight-tooltip">
            <div class="tooltip-content" id="spotlight-tooltip-content"></div>
            <div class="tooltip-arrow"></div>
        </div>
    </div>

    <!-- Floating Help/Glossary Button -->
    <button class="floating-help-button" onclick="showGlossaryModal()" title="Open Glossary & Help">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
    </button>

    <!-- Rollback UI Components -->
    
    <!-- Start Over Button -->
    <button id="start-over-button" class="start-over-button" onclick="confirmStartOver()" title="Start over from beginning">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
            <path d="M3 3v5h5"/>
        </svg>
        Start Over
    </button>

    <!-- Version History Modal -->
    <div id="version-history-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configuration History</h2>
                <button class="modal-close" onclick="closeVersionHistoryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-description">
                    View and restore previous configuration versions. Each time you make changes, 
                    a version is automatically saved so you can roll back if needed.
                </p>
                <div id="version-history-list" class="version-history-list">
                    <p class="loading">Loading version history...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeVersionHistoryModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Start Over Confirmation Modal -->
    <div id="start-over-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîÑ Start Over?</h2>
                <button class="modal-close" onclick="closeStartOverModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p class="warning-message">
                    This will reset the wizard and clear your current progress.
                </p>
                <div class="warning-details">
                    <h4>What will happen:</h4>
                    <ul>
                        <li>All wizard progress will be lost</li>
                        <li>Configuration selections will be cleared</li>
                        <li>You will return to the welcome screen</li>
                    </ul>
                    <h4>What won't be affected:</h4>
                    <ul>
                        <li>Running services will continue</li>
                        <li>Existing data will be preserved</li>
                        <li>Configuration backups will be kept</li>
                    </ul>
                </div>
                <div class="start-over-options">
                    <label>
                        <input type="checkbox" id="delete-data-checkbox">
                        Also remove all containers and volumes
                    </label>
                    <label>
                        <input type="checkbox" id="delete-config-checkbox">
                        Also delete configuration files
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeStartOverModal()">Cancel</button>
                <button class="btn-danger" onclick="executeStartOver()">Start Over</button>
            </div>
        </div>
    </div>

    <!-- Error Recovery Dialog -->
    <div id="error-recovery-dialog" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ö†Ô∏è Installation Error</h2>
                <button class="modal-close" onclick="closeErrorRecoveryDialog()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="error-details">
                    <p><strong>Stage:</strong> <span class="error-stage"></span></p>
                    <p><strong>Error:</strong> <span class="error-message"></span></p>
                </div>
                <h4>Recovery Options:</h4>
                <div class="recovery-options">
                    <button class="btn-primary" onclick="retryInstallation()">
                        üîÑ Retry Installation
                    </button>
                    <button class="btn-secondary" onclick="window.rollback.undoLastChange()">
                        ‚Ü∂ Undo Last Change
                    </button>
                    <button class="btn-secondary" onclick="window.rollback.showVersionHistoryModal()">
                        üìã View Version History
                    </button>
                    <button class="btn-secondary" onclick="showDiagnosticExport()">
                        üìä Export Diagnostic Report
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeErrorRecoveryDialog()">Close</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script type="module" src="/scripts/wizard-refactored.js?v=4"></script>
    <script type="module" src="/scripts/modules/template-selection.js?v=10"></script>
    <script type="module" src="/scripts/modules/enhanced-troubleshooting.js?v=1"></script>
    <script type="module" src="/scripts/modules/profile-addition.js?v=1"></script>
    <script type="module" src="/scripts/modules/navigation.js?v=7"></script>
    <script src="/scripts/glossary.js?v=4"></script>
    
    <!-- Global Navigation Functions -->
    <script type="module">
        import { nextStep as moduleNextStep, previousStep as modulePreviousStep } from '/scripts/modules/navigation.js?v=7';
        
        // Make navigation functions globally available
        window.nextStep = moduleNextStep;
        window.previousStep = modulePreviousStep;
    </script>
    
    <!-- Rollback UI Helper Functions -->
    <script>
        // Modal management functions
        function closeVersionHistoryModal() {
            document.getElementById('version-history-modal').style.display = 'none';
        }
        
        function closeStartOverModal() {
            document.getElementById('start-over-modal').style.display = 'none';
        }
        
        function closeErrorRecoveryDialog() {
            document.getElementById('error-recovery-dialog').style.display = 'none';
        }
        
        // Start over confirmation
        function confirmStartOver() {
            document.getElementById('start-over-modal').style.display = 'block';
        }
        
        // Execute start over
        async function executeStartOver() {
            const deleteData = document.getElementById('delete-data-checkbox').checked;
            const deleteConfig = document.getElementById('delete-config-checkbox').checked;
            
            closeStartOverModal();
            
            if (window.rollback) {
                await window.rollback.startOver({
                    deleteData,
                    deleteConfig,
                    deleteBackups: false
                });
            }
        }
        
        // Retry installation
        function retryInstallation() {
            closeErrorRecoveryDialog();
            if (window.wizard) {
                window.wizard.startInstallation();
            }
        }
        
        // Show diagnostic export
        function showDiagnosticExport() {
            closeErrorRecoveryDialog();
            // This will be handled by diagnostic module
            if (window.diagnostic) {
                window.diagnostic.showExportDialog();
            }
        }
        
        // Undo button removed - users can use Back button to change configuration
        // Rollback functionality preserved for post-installation use
        
        // Start Over - simple localStorage clear and reload
        function confirmStartOver() {
            const confirmed = confirm(
                'This will reset the wizard and clear all your selections. ' +
                'Are you sure you want to start over?'
            );
            
            if (confirmed) {
                // Clear all localStorage
                localStorage.clear();
                // Set wizard version to prevent re-clearing on reload
                localStorage.setItem('wizardVersion', '3');
                // Reload page with ?mode=initial to force initial installation mode
                window.location.href = window.location.pathname + '?mode=initial';
            }
        }
        
        // Port Configuration Modal Functions
        function openPortConfigModal() {
            const modal = document.getElementById('port-config-modal');
            if (modal) {
                modal.style.display = 'flex';
                // Load current values
                const rpcPort = document.getElementById('rpc-port-display').textContent;
                const p2pPort = document.getElementById('p2p-port-display').textContent;
                document.getElementById('rpc-port-input').value = rpcPort;
                document.getElementById('p2p-port-input').value = p2pPort;
            }
        }
        
        function closePortConfigModal() {
            const modal = document.getElementById('port-config-modal');
            if (modal) {
                modal.style.display = 'none';
                // Clear validation errors
                clearPortValidationErrors();
            }
        }
        
        function clearPortValidationErrors() {
            const errorElements = document.querySelectorAll('.port-error-message');
            errorElements.forEach(el => el.remove());
            
            const inputs = document.querySelectorAll('.port-input');
            inputs.forEach(input => input.classList.remove('input-error'));
        }
        
        function resetPortsToDefaults() {
            document.getElementById('rpc-port-input').value = '16110';
            document.getElementById('p2p-port-input').value = '16111';
            clearPortValidationErrors();
        }
        
        async function savePortConfiguration() {
            const rpcPort = parseInt(document.getElementById('rpc-port-input').value);
            const p2pPort = parseInt(document.getElementById('p2p-port-input').value);
            
            // Clear previous errors
            clearPortValidationErrors();
            
            // Validate ports
            let hasErrors = false;
            
            // Validate RPC port
            if (isNaN(rpcPort) || rpcPort < 1024 || rpcPort > 65535) {
                showPortError('rpc-port-input', 'Port must be between 1024 and 65535');
                hasErrors = true;
            }
            
            // Validate P2P port
            if (isNaN(p2pPort) || p2pPort < 1024 || p2pPort > 65535) {
                showPortError('p2p-port-input', 'Port must be between 1024 and 65535');
                hasErrors = true;
            }
            
            // Check for port conflict
            if (!hasErrors && rpcPort === p2pPort) {
                showPortError('p2p-port-input', 'P2P port must be different from RPC port');
                hasErrors = true;
            }
            
            if (hasErrors) {
                return;
            }
            
            // Update display values
            document.getElementById('rpc-port-display').textContent = rpcPort;
            document.getElementById('p2p-port-display').textContent = p2pPort;
            
            // Store in state (will be handled by configure module)
            if (window.stateManager) {
                const config = window.stateManager.get('configuration') || {};
                config.KASPA_NODE_RPC_PORT = rpcPort;
                config.KASPA_NODE_P2P_PORT = p2pPort;
                window.stateManager.set('configuration', config);
            }
            
            // Close modal
            closePortConfigModal();
            
            // Show success notification
            if (window.showNotification) {
                window.showNotification('Port configuration saved', 'success');
            }
        }
        
        function showPortError(inputId, message) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            input.classList.add('input-error');
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'port-error-message';
            errorDiv.textContent = message;
            input.parentElement.appendChild(errorDiv);
        }
        
        // Network Change Warning Functions
        function openNetworkChangeWarning(newNetwork) {
            const modal = document.getElementById('network-change-warning-modal');
            if (modal) {
                document.getElementById('new-network-name').textContent = newNetwork;
                modal.style.display = 'flex';
            }
        }
        
        function closeNetworkChangeWarning() {
            const modal = document.getElementById('network-change-warning-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function cancelNetworkChange() {
            // Revert to previous network selection
            const currentNetwork = document.getElementById('current-network-display').textContent;
            document.getElementById('kaspa-network').value = currentNetwork;
            closeNetworkChangeWarning();
        }
        
        function confirmNetworkChange() {
            const newNetwork = document.getElementById('kaspa-network').value;
            document.getElementById('current-network-display').textContent = newNetwork;
            
            // Store in state
            if (window.stateManager) {
                const config = window.stateManager.get('configuration') || {};
                config.KASPA_NETWORK = newNetwork;
                window.stateManager.set('configuration', config);
            }
            
            closeNetworkChangeWarning();
            
            // Show notification
            if (window.showNotification) {
                window.showNotification(`Network changed to ${newNetwork}. Fresh installation recommended.`, 'warning', 5000);
            }
        }
    </script>
    
    <!-- Port Configuration Modal -->
    <div id="port-config-modal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closePortConfigModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Configure Kaspa Node Ports</h3>
                <button class="modal-close" onclick="closePortConfigModal()" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-description">
                    Configure the ports used by the Kaspa node for RPC and P2P connections.
                </p>
                
                <div class="form-group">
                    <label for="rpc-port-input" class="form-label">
                        RPC Port
                        <span class="form-tooltip" title="Port for RPC API connections">‚ìò</span>
                    </label>
                    <input type="number" id="rpc-port-input" class="form-input port-input" 
                           value="16110" min="1024" max="65535" />
                    <p class="form-help-text">Default: 16110</p>
                </div>
                
                <div class="form-group">
                    <label for="p2p-port-input" class="form-label">
                        P2P Port
                        <span class="form-tooltip" title="Port for peer-to-peer connections">‚ìò</span>
                    </label>
                    <input type="number" id="p2p-port-input" class="form-input port-input" 
                           value="16111" min="1024" max="65535" />
                    <p class="form-help-text">Default: 16111</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="resetPortsToDefaults()">
                    Reset to Defaults
                </button>
                <div class="modal-footer-actions">
                    <button class="btn-secondary" onclick="closePortConfigModal()">
                        Cancel
                    </button>
                    <button class="btn-primary" onclick="savePortConfiguration()">
                        Save Configuration
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Network Change Warning Modal -->
    <div id="network-change-warning-modal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeNetworkChangeWarning()"></div>
        <div class="modal-content modal-warning">
            <div class="modal-header">
                <div class="modal-warning-icon">‚ö†Ô∏è</div>
                <h3 class="modal-title">Network Change Warning</h3>
                <button class="modal-close" onclick="closeNetworkChangeWarning()" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-description">
                    You are about to change the Kaspa network to <strong id="new-network-name">testnet</strong>.
                </p>
                
                <div class="warning-box">
                    <h4>‚ö†Ô∏è Important Information</h4>
                    <ul>
                        <li><strong>Data Incompatibility:</strong> Mainnet and testnet data are not compatible</li>
                        <li><strong>Fresh Installation Required:</strong> Changing networks requires a fresh installation</li>
                        <li><strong>Existing Data:</strong> Any existing blockchain data will not work with the new network</li>
                    </ul>
                </div>
                
                <p class="modal-description">
                    If you have an existing installation, you should perform a fresh installation after changing the network.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="cancelNetworkChange()">
                    Cancel
                </button>
                <button class="btn-primary btn-warning" onclick="confirmNetworkChange()">
                    Change Network
                </button>
            </div>
        </div>
    </div>
    
    <!-- Load error display before main wizard script -->
    <script src="/scripts/modules/error-display.js"></script>
</body>
</html>
